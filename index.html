<html>
    <head>
        <link rel="stylesheet" href="styles.css" type="text/css">
    </head>

    <body style="background-color: rgb(40, 40, 40);">
        <canvas id="c" width="1800" height="900"></canvas>
        <div id="fps-container"><span id="fps"></span> FPS</div>
        <div class="controls">
            <div class="section">
                <h3>Rendering settings</h3>
                <input type="checkbox" id="enableGI"> GI on/off
                <br>
                <input type="checkbox" id="enableRefGI"> GI on/off in reflections
                <br>
                number of GI samples:
                <br>
                <div class="slider_container">
                    <input type="range" value="50" id="indirectsamples" min="1" max="100" oninput="this.nextElementSibling.value = this.value">
                    <output>50</output>
                </div>
                <br>
                number of shadow samples:
                <br>
                <div class="slider_container">
                    <input type="range" list="tickmarks" value="9" id="shadowsamples" min="1" max="49" oninput="this.nextElementSibling.value = this.value">
                    <output>9</output>
                </div>
                <datalist id="tickmarks">
                    <option value="1" label="1"></option>
                    <option value="4" label="4"></option>
                    <option value="9" label="9"></option>
                    <option value="16" label="16"></option>
                    <option value="25" label="25"></option>
                    <option value="36" label="36"></option>
                    <option value="49" label="49"></option>
                </datalist>
                <br>
                reflection bounces:
                <br>
                <div class="slider_container">
                    <input type="range" value="3" id="reflectionbounces" min="0" max="5" step="1" oninput="this.nextElementSibling.value = this.value">
                    <output>3</output>
                </div>
            </div>
            <div class="section" id="lightcontrols">
                <h3>Lights</h3>
                <input type="checkbox" id="arealightsenable" checked> Area lights on/off
                <br>
            </div>
            <div class="section" id="planecontrols">
                <h3>Planes</h3>
                <input type="checkbox" id="planebacksides" checked> Intersect backsides
                <br><br>
            </div>
            <div class="section">
                <h3>Extras</h3>
                <input type="checkbox" id="enablemirrorworld"> Mirror world
                <br>
            </div>
            
        </div>

        <script id="vertex-shader" type="x-shader/x-vertex">#version 300 es
            precision highp float;
            uniform mat4 invprojview;
            uniform float near;
            uniform float far;
            
            out lowp vec3 origin;
            out lowp vec3 ray;
            
            void main() {
                // https://rauwendaal.net/2014/06/14/rendering-a-screen-covering-triangle-in-opengl/
                float x = -1.0 + float((gl_VertexID & 1) << 2);
                float y = -1.0 + float((gl_VertexID & 2) << 1);
                gl_Position = vec4(x, y, 0, 1);
                            
                // https://stackoverflow.com/a/52764898
                origin = (invprojview * vec4(x, y, -1.0, 1.0) * near).xyz;
                ray = (invprojview * vec4(vec2(x,y) * (far - near), far + near, far - near)).xyz;
            }
        </script>
        <!-- Fragment GLSL optimized with: https://zz85.github.io/glsl-optimizer/ -->
        <script id="fragment-shader" type="x-shader/x-fragment">#version 300 es
          precision mediump float;
          float randomSeed;
          uniform highp int numLights;
          uniform vec3 lightPos[2];
          uniform vec2 lightSize[2];
          uniform vec3 lightIntensity[2];
          uniform highp int shadowSamples;
          uniform float shadowDim;
          uniform highp int numSpheres;
          uniform vec3 sphereCenters[5];
          uniform vec3 sphereColors[5];
          uniform vec3 reflectiveColors[5];
          uniform highp int numPlanes;
          uniform float planeOffsets[6];
          uniform vec3 planeNormals[6];
          uniform vec3 planeColors[6];
          uniform highp int rayBounces;
          uniform vec3 ambientLight;
          uniform bool enableGI;
          uniform bool enableRefGI;
          uniform highp int indirectSamples;
          uniform bool enablePlaneBacksides;
          uniform bool enablePlaneMirrors;
          in lowp vec3 origin;
          in lowp vec3 ray;
          out lowp vec4 fragColor;
          void main ()
          {
            randomSeed = 0.1;
            vec3 reflectiveColor_1;
            vec3 specularColor_2;
            vec3 diffuseColor_3;
            lowp vec3 pixelColor_4;
            lowp vec3 tmpvar_5;
            tmpvar_5 = normalize(ray);
            lowp vec3 ray_origin_6;
            ray_origin_6 = origin;
            lowp vec3 ray_direction_7;
            ray_direction_7 = tmpvar_5;
            lowp float t_hit_8;
            t_hit_8 = sqrt(dot (ray, ray));
            lowp vec3 position_9;
            lowp vec3 normal_10;
            vec3 diffuseColor_11;
            diffuseColor_11 = diffuseColor_3;
            vec3 specularColor_12;
            specularColor_12 = specularColor_2;
            vec3 reflectiveColor_13;
            reflectiveColor_13 = reflectiveColor_1;
            bool isLight_14;
            isLight_14 = bool(0);
            highp int i_15;
            highp int i_16;
            highp int i_17;
            highp int idx_18;
            highp int intersected_19;
            intersected_19 = 0;
            idx_18 = 0;
            i_17 = 0;
            while (true) {
              if ((i_17 >= 5)) {
                break;
              };
              if ((i_17 >= numSpheres)) {
                break;
              };
              lowp float t_hit_20;
              t_hit_20 = t_hit_8;
              bool tmpvar_21;
              lowp vec3 tmpvar_22;
              tmpvar_22 = (sphereCenters[i_17] - ray_origin_6);
              lowp float tmpvar_23;
              tmpvar_23 = dot (ray_direction_7, ray_direction_7);
              lowp float tmpvar_24;
              tmpvar_24 = (-2.0 * dot (ray_direction_7, tmpvar_22));
              lowp float tmpvar_25;
              tmpvar_25 = ((tmpvar_24 * tmpvar_24) - ((4.0 * tmpvar_23) * (
                dot (tmpvar_22, tmpvar_22)
               - 0.64)));
              if ((tmpvar_25 < 0.0)) {
                tmpvar_21 = bool(0);
              } else {
                lowp float tmpvar_26;
                tmpvar_26 = sqrt(tmpvar_25);
                lowp float tmpvar_27;
                tmpvar_27 = ((-(tmpvar_24) - tmpvar_26) / (2.0 * tmpvar_23));
                lowp float tmpvar_28;
                tmpvar_28 = ((-(tmpvar_24) + tmpvar_26) / (2.0 * tmpvar_23));
                lowp float tmpvar_29;
                if ((tmpvar_27 < 0.0)) {
                  tmpvar_29 = tmpvar_28;
                } else {
                  tmpvar_29 = tmpvar_27;
                };
                if (((tmpvar_29 < t_hit_8) && (tmpvar_29 > 0.0))) {
                  t_hit_20 = tmpvar_29;
                  tmpvar_21 = bool(1);
                } else {
                  tmpvar_21 = bool(0);
                };
              };
              t_hit_8 = t_hit_20;
              if (tmpvar_21) {
                idx_18 = i_17;
                intersected_19 = 1;
              };
              i_17++;
            };
            i_16 = 0;
            while (true) {
              bool tmp_30;
              if ((i_16 >= 6)) {
                break;
              };
              if ((i_16 >= numPlanes)) {
                break;
              };
              lowp vec3 tmpvar_31;
              tmpvar_31 = planeNormals[i_16];
              tmp_30 = bool(0);
              bool tmpvar_32;
              if (enablePlaneBacksides) {
                tmpvar_32 = bool(1);
              } else {
                tmpvar_32 = (dot (ray_direction_7, tmpvar_31) < 0.0);
              };
              if (tmpvar_32) {
                lowp float t_hit_33;
                t_hit_33 = t_hit_8;
                bool tmpvar_34;
                tmpvar_34 = bool(1);
                bool tmpvar_35;
                lowp vec3 tmpvar_36;
                tmpvar_36 = (tmpvar_31 * planeOffsets[i_16]);
                lowp float tmpvar_37;
                tmpvar_37 = (((
                  (tmpvar_36.x + tmpvar_36.y)
                 + tmpvar_36.z) - dot (tmpvar_31, ray_origin_6)) / dot (tmpvar_31, ray_direction_7));
                if (((tmpvar_37 < t_hit_8) && (tmpvar_37 > 0.0))) {
                  t_hit_33 = tmpvar_37;
                  tmpvar_35 = bool(1);
                  tmpvar_34 = bool(0);
                };
                if (tmpvar_34) {
                  tmpvar_35 = bool(0);
                  tmpvar_34 = bool(0);
                };
                t_hit_8 = t_hit_33;
                tmp_30 = tmpvar_35;
              };
              if (tmp_30) {
                normal_10 = tmpvar_31;
                idx_18 = i_16;
                intersected_19 = 2;
              };
              i_16++;
            };
            i_15 = 0;
            bool tmp_38;
            if ((0 < numLights)) {
              vec3 tmpvar_39;
              tmpvar_39 = lightPos[0];
              vec2 tmpvar_40;
              tmpvar_40 = lightSize[0];
              tmp_38 = bool(0);
              float tmpvar_41;
              tmpvar_41 = sqrt(dot (tmpvar_40, tmpvar_40));
              if ((tmpvar_41 > 0.0)) {
                lowp float t_hit_42;
                t_hit_42 = t_hit_8;
                bool tmpvar_43;
                tmpvar_43 = bool(1);
                bool tmpvar_44;
                vec3 tmpvar_45;
                tmpvar_45 = (vec3(0.0, 1.0, 0.0) * tmpvar_39.y);
                lowp float tmpvar_46;
                tmpvar_46 = (((
                  (tmpvar_45.x + tmpvar_45.y)
                 + tmpvar_45.z) - origin.y) / tmpvar_5.y);
                if (((tmpvar_46 < t_hit_8) && (tmpvar_46 > 0.0))) {
                  lowp vec3 tmpvar_47;
                  tmpvar_47 = (origin + (tmpvar_5 * tmpvar_46));
                  float tmpvar_48;
                  tmpvar_48 = sqrt(dot (tmpvar_40, tmpvar_40));
                  if (((tmpvar_48 == 0.0) || ((
                    ((tmpvar_47.x < (tmpvar_39.x + (tmpvar_40.x * 0.5))) && (tmpvar_47.x > (tmpvar_39.x - (tmpvar_40.x * 0.5))))
                   && 
                    (tmpvar_47.z < (tmpvar_39.z + (tmpvar_40.y * 0.5)))
                  ) && (tmpvar_47.z > 
                    (tmpvar_39.z - (tmpvar_40.y * 0.5))
                  )))) {
                    t_hit_42 = tmpvar_46;
                    tmpvar_44 = bool(1);
                    tmpvar_43 = bool(0);
                  };
                };
                if (tmpvar_43) {
                  tmpvar_44 = bool(0);
                  tmpvar_43 = bool(0);
                };
                t_hit_8 = t_hit_42;
                tmp_38 = tmpvar_44;
              } else {
                lowp float t_hit_49;
                t_hit_49 = t_hit_8;
                bool tmpvar_50;
                lowp vec3 tmpvar_51;
                tmpvar_51 = (tmpvar_39 - origin);
                lowp float tmpvar_52;
                tmpvar_52 = dot (tmpvar_5, tmpvar_5);
                lowp float tmpvar_53;
                tmpvar_53 = (-2.0 * dot (tmpvar_5, tmpvar_51));
                lowp float tmpvar_54;
                tmpvar_54 = ((tmpvar_53 * tmpvar_53) - ((4.0 * tmpvar_52) * (
                  dot (tmpvar_51, tmpvar_51)
                 - 0.01)));
                if ((tmpvar_54 < 0.0)) {
                  tmpvar_50 = bool(0);
                } else {
                  lowp float tmpvar_55;
                  tmpvar_55 = sqrt(tmpvar_54);
                  lowp float tmpvar_56;
                  tmpvar_56 = ((-(tmpvar_53) - tmpvar_55) / (2.0 * tmpvar_52));
                  lowp float tmpvar_57;
                  tmpvar_57 = ((-(tmpvar_53) + tmpvar_55) / (2.0 * tmpvar_52));
                  lowp float tmpvar_58;
                  if ((tmpvar_56 < 0.0)) {
                    tmpvar_58 = tmpvar_57;
                  } else {
                    tmpvar_58 = tmpvar_56;
                  };
                  if (((tmpvar_58 < t_hit_8) && (tmpvar_58 > 0.0))) {
                    t_hit_49 = tmpvar_58;
                    tmpvar_50 = bool(1);
                  } else {
                    tmpvar_50 = bool(0);
                  };
                };
                t_hit_8 = t_hit_49;
                tmp_38 = tmpvar_50;
              };
              if (tmp_38) {
                idx_18 = i_15;
                intersected_19 = 3;
              };
              i_15 = 1;
              bool tmp_59;
              if ((1 < numLights)) {
                vec3 tmpvar_60;
                tmpvar_60 = lightPos[1];
                vec2 tmpvar_61;
                tmpvar_61 = lightSize[1];
                tmp_59 = bool(0);
                float tmpvar_62;
                tmpvar_62 = sqrt(dot (tmpvar_61, tmpvar_61));
                if ((tmpvar_62 > 0.0)) {
                  lowp float t_hit_63;
                  t_hit_63 = t_hit_8;
                  bool tmpvar_64;
                  tmpvar_64 = bool(1);
                  bool tmpvar_65;
                  vec3 tmpvar_66;
                  tmpvar_66 = (vec3(0.0, 1.0, 0.0) * tmpvar_60.y);
                  lowp float tmpvar_67;
                  tmpvar_67 = (((
                    (tmpvar_66.x + tmpvar_66.y)
                   + tmpvar_66.z) - origin.y) / tmpvar_5.y);
                  if (((tmpvar_67 < t_hit_8) && (tmpvar_67 > 0.0))) {
                    lowp vec3 tmpvar_68;
                    tmpvar_68 = (origin + (tmpvar_5 * tmpvar_67));
                    float tmpvar_69;
                    tmpvar_69 = sqrt(dot (tmpvar_61, tmpvar_61));
                    if (((tmpvar_69 == 0.0) || ((
                      ((tmpvar_68.x < (tmpvar_60.x + (tmpvar_61.x * 0.5))) && (tmpvar_68.x > (tmpvar_60.x - (tmpvar_61.x * 0.5))))
                     && 
                      (tmpvar_68.z < (tmpvar_60.z + (tmpvar_61.y * 0.5)))
                    ) && (tmpvar_68.z > 
                      (tmpvar_60.z - (tmpvar_61.y * 0.5))
                    )))) {
                      t_hit_63 = tmpvar_67;
                      tmpvar_65 = bool(1);
                      tmpvar_64 = bool(0);
                    };
                  };
                  if (tmpvar_64) {
                    tmpvar_65 = bool(0);
                    tmpvar_64 = bool(0);
                  };
                  t_hit_8 = t_hit_63;
                  tmp_59 = tmpvar_65;
                } else {
                  lowp float t_hit_70;
                  t_hit_70 = t_hit_8;
                  bool tmpvar_71;
                  lowp vec3 tmpvar_72;
                  tmpvar_72 = (tmpvar_60 - origin);
                  lowp float tmpvar_73;
                  tmpvar_73 = dot (tmpvar_5, tmpvar_5);
                  lowp float tmpvar_74;
                  tmpvar_74 = (-2.0 * dot (tmpvar_5, tmpvar_72));
                  lowp float tmpvar_75;
                  tmpvar_75 = ((tmpvar_74 * tmpvar_74) - ((4.0 * tmpvar_73) * (
                    dot (tmpvar_72, tmpvar_72)
                   - 0.01)));
                  if ((tmpvar_75 < 0.0)) {
                    tmpvar_71 = bool(0);
                  } else {
                    lowp float tmpvar_76;
                    tmpvar_76 = sqrt(tmpvar_75);
                    lowp float tmpvar_77;
                    tmpvar_77 = ((-(tmpvar_74) - tmpvar_76) / (2.0 * tmpvar_73));
                    lowp float tmpvar_78;
                    tmpvar_78 = ((-(tmpvar_74) + tmpvar_76) / (2.0 * tmpvar_73));
                    lowp float tmpvar_79;
                    if ((tmpvar_77 < 0.0)) {
                      tmpvar_79 = tmpvar_78;
                    } else {
                      tmpvar_79 = tmpvar_77;
                    };
                    if (((tmpvar_79 < t_hit_8) && (tmpvar_79 > 0.0))) {
                      t_hit_70 = tmpvar_79;
                      tmpvar_71 = bool(1);
                    } else {
                      tmpvar_71 = bool(0);
                    };
                  };
                  t_hit_8 = t_hit_70;
                  tmp_59 = tmpvar_71;
                };
                if (tmp_59) {
                  idx_18 = i_15;
                  intersected_19 = 3;
                };
                i_15 = 2;
              };
            };
            position_9 = (origin + (tmpvar_5 * t_hit_8));
            if ((intersected_19 == 1)) {
              diffuseColor_11 = sphereColors[idx_18];
              specularColor_12 = vec3(1.0, 1.0, 1.0);
              reflectiveColor_13 = reflectiveColors[idx_18];
              lowp vec3 tmpvar_80;
              tmpvar_80 = normalize((position_9 - sphereCenters[idx_18]));
              normal_10 = tmpvar_80;
              lowp float tmpvar_81;
              tmpvar_81 = dot (tmpvar_80, -(tmpvar_5));
              if ((tmpvar_81 < 0.0)) {
                normal_10 = -(tmpvar_80);
              };
            } else {
              if ((intersected_19 == 2)) {
                if (enablePlaneMirrors) {
                  diffuseColor_11 = vec3(0.1, 0.1, 0.1);
                  specularColor_12 = vec3(0.0, 0.0, 0.0);
                  reflectiveColor_13 = vec3(1.0, 1.0, 1.0);
                } else {
                  diffuseColor_11 = planeColors[idx_18];
                  specularColor_12 = vec3(0.5, 0.5, 0.5);
                  reflectiveColor_13 = vec3(0.0, 0.0, 0.0);
                };
                lowp float tmpvar_82;
                tmpvar_82 = dot (normal_10, -(tmpvar_5));
                if ((tmpvar_82 < 0.0)) {
                  normal_10 = -(normal_10);
                };
              } else {
                if ((intersected_19 == 3)) {
                  diffuseColor_11 = lightIntensity[idx_18];
                  isLight_14 = bool(1);
                };
              };
            };
            diffuseColor_3 = diffuseColor_11;
            specularColor_2 = specularColor_12;
            reflectiveColor_1 = reflectiveColor_13;
            if (isLight_14) {
              lowp vec4 tmpvar_83;
              tmpvar_83.w = 1.0;
              tmpvar_83.xyz = diffuseColor_11;
              fragColor = tmpvar_83;
              return;
            };
            if (!(enableGI)) {
              pixelColor_4 = (pixelColor_4 + (ambientLight * diffuseColor_11));
            };
            lowp vec3 point_84;
            point_84 = position_9;
            lowp vec3 ray_dir_85;
            ray_dir_85 = tmpvar_5;
            lowp vec3 normal_86;
            normal_86 = normal_10;
            vec3 diffuseColor_87;
            diffuseColor_87 = diffuseColor_11;
            vec3 specularColor_88;
            specularColor_88 = specularColor_12;
            highp int i_89;
            lowp vec3 illuminationColor_90;
            i_89 = 0;
            while (true) {
              highp int k_91;
              lowp vec3 light_sum_92;
              vec2 lightSize_93;
              vec3 lightIntensity_94;
              vec3 lightPos_95;
              highp int areaShadowSamples_96;
              if ((i_89 >= 2)) {
                break;
              };
              if ((i_89 >= numLights)) {
                break;
              };
              float tmpvar_97;
              vec2 x_98;
              x_98 = lightSize[i_89];
              tmpvar_97 = sqrt(dot (x_98, x_98));
              highp int tmpvar_99;
              if ((tmpvar_97 > 0.0)) {
                tmpvar_99 = shadowSamples;
              } else {
                tmpvar_99 = 1;
              };
              areaShadowSamples_96 = tmpvar_99;
              lightPos_95 = lightPos[i_89];
              lightIntensity_94 = lightIntensity[i_89];
              lightSize_93 = lightSize[i_89];
              k_91 = 0;
              while (true) {
                lowp vec3 incident_intensity_100;
                if ((k_91 >= 49)) {
                  break;
                };
                if ((k_91 >= areaShadowSamples_96)) {
                  break;
                };
                float sample_i_101;
                sample_i_101 = float(k_91);
                lowp vec3 vec_to_light_102;
                float tmpvar_103;
                tmpvar_103 = sqrt(dot (lightSize_93, lightSize_93));
                if ((tmpvar_103 > 0.0)) {
                  float tmpvar_104;
                  tmpvar_104 = (1.0/(shadowDim));
                  randomSeed += 0.02;
                  lowp float tmpvar_105;
                  tmpvar_105 = ((lightSize_93.x * tmpvar_104) * ((float(mod (sample_i_101, shadowDim))) + fract(
                    (cos(dot ((point_84.xy + randomSeed), vec2(23.14069, 2.665144))) * 12345.68)
                  )));
                  randomSeed += 0.02;
                  lowp vec3 tmpvar_106;
                  tmpvar_106.x = ((lightPos_95.x - (lightSize_93.x * 0.5)) + tmpvar_105);
                  tmpvar_106.y = lightPos_95.y;
                  tmpvar_106.z = ((lightPos_95.z - (lightSize_93.y * 0.5)) + ((lightSize_93.y * tmpvar_104) * (
                    floor((sample_i_101 * tmpvar_104))
                   + 
                    fract((cos(dot (
                      (point_84.yx + randomSeed)
                    , vec2(23.14069, 2.665144))) * 12345.68))
                  )));
                  vec_to_light_102 = (tmpvar_106 - point_84);
                } else {
                  vec_to_light_102 = (lightPos_95 - point_84);
                };
                lowp float tmpvar_107;
                tmpvar_107 = sqrt(dot (vec_to_light_102, vec_to_light_102));
                lowp vec3 tmpvar_108;
                tmpvar_108 = normalize(vec_to_light_102);
                vec_to_light_102 = tmpvar_108;
                incident_intensity_100 = (lightIntensity_94 * (1.0/((
                  (0.1 * (tmpvar_107 * tmpvar_107))
                 + 
                  (0.4 * tmpvar_107)
                ))));
                lowp vec3 ray_origin_109;
                ray_origin_109 = point_84;
                lowp vec3 ray_direction_110;
                ray_direction_110 = tmpvar_108;
                lowp float t_hit_111;
                t_hit_111 = tmpvar_107;
                bool tmpvar_112;
                tmpvar_112 = bool(0);
                highp int i_113;
                highp int i_114;
                i_114 = 0;
                while (true) {
                  if ((i_114 >= 5)) {
                    break;
                  };
                  if ((i_114 >= numSpheres)) {
                    break;
                  };
                  lowp float t_hit_115;
                  t_hit_115 = t_hit_111;
                  bool tmpvar_116;
                  lowp vec3 tmpvar_117;
                  tmpvar_117 = (sphereCenters[i_114] - ray_origin_109);
                  lowp float tmpvar_118;
                  tmpvar_118 = dot (ray_direction_110, ray_direction_110);
                  lowp float tmpvar_119;
                  tmpvar_119 = (-2.0 * dot (ray_direction_110, tmpvar_117));
                  lowp float tmpvar_120;
                  tmpvar_120 = ((tmpvar_119 * tmpvar_119) - ((4.0 * tmpvar_118) * (
                    dot (tmpvar_117, tmpvar_117)
                   - 0.64)));
                  if ((tmpvar_120 < 0.0)) {
                    tmpvar_116 = bool(0);
                  } else {
                    lowp float tmpvar_121;
                    tmpvar_121 = sqrt(tmpvar_120);
                    lowp float tmpvar_122;
                    tmpvar_122 = ((-(tmpvar_119) - tmpvar_121) / (2.0 * tmpvar_118));
                    lowp float tmpvar_123;
                    tmpvar_123 = ((-(tmpvar_119) + tmpvar_121) / (2.0 * tmpvar_118));
                    lowp float tmpvar_124;
                    if ((tmpvar_122 < 0.01)) {
                      tmpvar_124 = tmpvar_123;
                    } else {
                      tmpvar_124 = tmpvar_122;
                    };
                    if (((tmpvar_124 < t_hit_111) && (tmpvar_124 > 0.01))) {
                      t_hit_115 = tmpvar_124;
                      tmpvar_116 = bool(1);
                    } else {
                      tmpvar_116 = bool(0);
                    };
                  };
                  t_hit_111 = t_hit_115;
                  if (tmpvar_116) {
                    tmpvar_112 = bool(1);
                    break;
                  };
                  i_114++;
                };
                if (!(tmpvar_112)) {
                  i_113 = 0;
                  while (true) {
                    if ((i_113 >= 6)) {
                      break;
                    };
                    if ((i_113 >= numPlanes)) {
                      break;
                    };
                    vec3 normal_125;
                    normal_125 = planeNormals[i_113];
                    lowp float t_hit_126;
                    t_hit_126 = t_hit_111;
                    bool tmpvar_127;
                    tmpvar_127 = bool(1);
                    bool tmpvar_128;
                    vec3 tmpvar_129;
                    tmpvar_129 = (normal_125 * planeOffsets[i_113]);
                    lowp float tmpvar_130;
                    tmpvar_130 = (((
                      (tmpvar_129.x + tmpvar_129.y)
                     + tmpvar_129.z) - dot (normal_125, ray_origin_109)) / dot (normal_125, ray_direction_110));
                    if (((tmpvar_130 < t_hit_111) && (tmpvar_130 > 0.01))) {
                      t_hit_126 = tmpvar_130;
                      tmpvar_128 = bool(1);
                      tmpvar_127 = bool(0);
                    };
                    if (tmpvar_127) {
                      tmpvar_128 = bool(0);
                      tmpvar_127 = bool(0);
                    };
                    t_hit_111 = t_hit_126;
                    if (tmpvar_128) {
                      tmpvar_112 = bool(1);
                      break;
                    };
                    i_113++;
                  };
                  if (!(tmpvar_112)) {
                    tmpvar_112 = bool(1);
                  };
                };
                lowp float tmpvar_131;
                tmpvar_131 = abs((t_hit_111 - tmpvar_107));
                if ((tmpvar_131 < 0.001)) {
                  lowp vec3 tmpvar_132;
                  lowp float tmpvar_133;
                  tmpvar_133 = dot (normal_86, tmpvar_108);
                  if ((tmpvar_133 > 0.0)) {
                    tmpvar_132 = ((incident_intensity_100 * max (0.0, 
                      dot (normal_86, tmpvar_108)
                    )) * (diffuseColor_87 + (specularColor_88 * 
                      pow (max (0.0, dot ((
                        -(tmpvar_108)
                       - 
                        ((2.0 * dot (-(tmpvar_108), normal_86)) * normal_86)
                      ), -(ray_dir_85))), 32.0)
                    )));
                  } else {
                    tmpvar_132 = vec3(0.0, 0.0, 0.0);
                  };
                  light_sum_92 = (light_sum_92 + tmpvar_132);
                };
                k_91++;
              };
              illuminationColor_90 = (illuminationColor_90 + (light_sum_92 / float(tmpvar_99)));
              i_89++;
            };
            pixelColor_4 = (pixelColor_4 + illuminationColor_90);
            if (enableGI) {
              lowp vec3 point_134;
              point_134 = position_9;
              lowp vec3 tmpvar_135;
              highp int k_136;
              lowp vec3 indirect_sampling_sum_137;
              lowp mat3 transform_138;
              float tmpvar_139;
              tmpvar_139 = sqrt(dot (diffuseColor_11, diffuseColor_11));
              if ((tmpvar_139 == 0.0)) {
                tmpvar_135 = vec3(0.0, 0.0, 0.0);
              } else {
                lowp float tmpvar_140;
                tmpvar_140 = abs(normal_10.x);
                lowp float tmpvar_141;
                tmpvar_141 = abs(normal_10.y);
                if ((tmpvar_140 > tmpvar_141)) {
                  lowp vec3 tmpvar_142;
                  tmpvar_142.y = 0.0;
                  tmpvar_142.x = normal_10.z;
                  tmpvar_142.z = -(normal_10.x);
                  transform_138[2] = (tmpvar_142 / sqrt((
                    (normal_10.x * normal_10.x)
                   + 
                    (normal_10.z * normal_10.z)
                  )));
                } else {
                  lowp vec3 tmpvar_143;
                  tmpvar_143.x = 0.0;
                  tmpvar_143.y = -(normal_10.z);
                  tmpvar_143.z = normal_10.y;
                  transform_138[2] = (tmpvar_143 / sqrt((
                    (normal_10.y * normal_10.y)
                   + 
                    (normal_10.z * normal_10.z)
                  )));
                };
                lowp vec3 b_144;
                b_144 = transform_138[2];
                transform_138[0] = ((normal_10.yzx * b_144.zxy) - (normal_10.zxy * b_144.yzx));
                transform_138[1] = normal_10;
                k_136 = 0;
                while (true) {
                  vec3 indirectReflectiveColor_145;
                  vec3 indirectSpecularColor_146;
                  vec3 indirectDiffuseColor_147;
                  if ((k_136 >= 100)) {
                    break;
                  };
                  if ((k_136 >= indirectSamples)) {
                    break;
                  };
                  randomSeed += 0.02;
                  lowp float tmpvar_148;
                  tmpvar_148 = fract((cos(
                    dot ((point_134.xy + randomSeed), vec2(23.14069, 2.665144))
                  ) * 12345.68));
                  lowp float tmpvar_149;
                  tmpvar_149 = sqrt((1.0 - (tmpvar_148 * tmpvar_148)));
                  randomSeed += 0.02;
                  lowp float tmpvar_150;
                  tmpvar_150 = (6.283186 * fract((
                    cos(dot ((point_134.yx + randomSeed), vec2(23.14069, 2.665144)))
                   * 12345.68)));
                  lowp vec3 tmpvar_151;
                  tmpvar_151.x = (cos(tmpvar_150) * tmpvar_149);
                  tmpvar_151.y = tmpvar_148;
                  tmpvar_151.z = (sin(tmpvar_150) * tmpvar_149);
                  lowp vec3 tmpvar_152;
                  tmpvar_152 = (transform_138 * tmpvar_151);
                  lowp vec3 ray_origin_153;
                  ray_origin_153 = point_134;
                  lowp vec3 ray_direction_154;
                  ray_direction_154 = tmpvar_152;
                  lowp float t_hit_155;
                  t_hit_155 = 10.0;
                  lowp vec3 position_156;
                  lowp vec3 normal_157;
                  vec3 diffuseColor_158;
                  diffuseColor_158 = indirectDiffuseColor_147;
                  vec3 specularColor_159;
                  specularColor_159 = indirectSpecularColor_146;
                  vec3 reflectiveColor_160;
                  reflectiveColor_160 = indirectReflectiveColor_145;
                  bool isLight_161;
                  isLight_161 = bool(0);
                  highp int i_162;
                  highp int i_163;
                  highp int i_164;
                  highp int idx_165;
                  highp int intersected_166;
                  intersected_166 = 0;
                  idx_165 = 0;
                  i_164 = 0;
                  while (true) {
                    if ((i_164 >= 5)) {
                      break;
                    };
                    if ((i_164 >= numSpheres)) {
                      break;
                    };
                    lowp float t_hit_167;
                    t_hit_167 = t_hit_155;
                    bool tmpvar_168;
                    lowp vec3 tmpvar_169;
                    tmpvar_169 = (sphereCenters[i_164] - ray_origin_153);
                    lowp float tmpvar_170;
                    tmpvar_170 = dot (ray_direction_154, ray_direction_154);
                    lowp float tmpvar_171;
                    tmpvar_171 = (-2.0 * dot (ray_direction_154, tmpvar_169));
                    lowp float tmpvar_172;
                    tmpvar_172 = ((tmpvar_171 * tmpvar_171) - ((4.0 * tmpvar_170) * (
                      dot (tmpvar_169, tmpvar_169)
                     - 0.64)));
                    if ((tmpvar_172 < 0.0)) {
                      tmpvar_168 = bool(0);
                    } else {
                      lowp float tmpvar_173;
                      tmpvar_173 = sqrt(tmpvar_172);
                      lowp float tmpvar_174;
                      tmpvar_174 = ((-(tmpvar_171) - tmpvar_173) / (2.0 * tmpvar_170));
                      lowp float tmpvar_175;
                      tmpvar_175 = ((-(tmpvar_171) + tmpvar_173) / (2.0 * tmpvar_170));
                      lowp float tmpvar_176;
                      if ((tmpvar_174 < 0.01)) {
                        tmpvar_176 = tmpvar_175;
                      } else {
                        tmpvar_176 = tmpvar_174;
                      };
                      if (((tmpvar_176 < t_hit_155) && (tmpvar_176 > 0.01))) {
                        t_hit_167 = tmpvar_176;
                        tmpvar_168 = bool(1);
                      } else {
                        tmpvar_168 = bool(0);
                      };
                    };
                    t_hit_155 = t_hit_167;
                    if (tmpvar_168) {
                      idx_165 = i_164;
                      intersected_166 = 1;
                    };
                    i_164++;
                  };
                  i_163 = 0;
                  while (true) {
                    bool tmp_177;
                    if ((i_163 >= 6)) {
                      break;
                    };
                    if ((i_163 >= numPlanes)) {
                      break;
                    };
                    lowp vec3 tmpvar_178;
                    tmpvar_178 = planeNormals[i_163];
                    tmp_177 = bool(0);
                    bool tmpvar_179;
                    if (enablePlaneBacksides) {
                      tmpvar_179 = bool(1);
                    } else {
                      tmpvar_179 = (dot (ray_direction_154, tmpvar_178) < 0.0);
                    };
                    if (tmpvar_179) {
                      lowp float t_hit_180;
                      t_hit_180 = t_hit_155;
                      bool tmpvar_181;
                      tmpvar_181 = bool(1);
                      bool tmpvar_182;
                      lowp vec3 tmpvar_183;
                      tmpvar_183 = (tmpvar_178 * planeOffsets[i_163]);
                      lowp float tmpvar_184;
                      tmpvar_184 = (((
                        (tmpvar_183.x + tmpvar_183.y)
                       + tmpvar_183.z) - dot (tmpvar_178, ray_origin_153)) / dot (tmpvar_178, ray_direction_154));
                      if (((tmpvar_184 < t_hit_155) && (tmpvar_184 > 0.01))) {
                        t_hit_180 = tmpvar_184;
                        tmpvar_182 = bool(1);
                        tmpvar_181 = bool(0);
                      };
                      if (tmpvar_181) {
                        tmpvar_182 = bool(0);
                        tmpvar_181 = bool(0);
                      };
                      t_hit_155 = t_hit_180;
                      tmp_177 = tmpvar_182;
                    };
                    if (tmp_177) {
                      normal_157 = tmpvar_178;
                      idx_165 = i_163;
                      intersected_166 = 2;
                    };
                    i_163++;
                  };
                  i_162 = 0;
                  bool tmp_185;
                  if ((0 < numLights)) {
                    vec3 tmpvar_186;
                    tmpvar_186 = lightPos[0];
                    vec2 tmpvar_187;
                    tmpvar_187 = lightSize[0];
                    tmp_185 = bool(0);
                    float tmpvar_188;
                    tmpvar_188 = sqrt(dot (tmpvar_187, tmpvar_187));
                    if ((tmpvar_188 > 0.0)) {
                      lowp float t_hit_189;
                      t_hit_189 = t_hit_155;
                      bool tmpvar_190;
                      tmpvar_190 = bool(1);
                      bool tmpvar_191;
                      vec3 tmpvar_192;
                      tmpvar_192 = (vec3(0.0, 1.0, 0.0) * tmpvar_186.y);
                      lowp float tmpvar_193;
                      tmpvar_193 = (((
                        (tmpvar_192.x + tmpvar_192.y)
                       + tmpvar_192.z) - point_134.y) / tmpvar_152.y);
                      if (((tmpvar_193 < t_hit_155) && (tmpvar_193 > 0.01))) {
                        lowp vec3 tmpvar_194;
                        tmpvar_194 = (point_134 + (tmpvar_152 * tmpvar_193));
                        float tmpvar_195;
                        tmpvar_195 = sqrt(dot (tmpvar_187, tmpvar_187));
                        if (((tmpvar_195 == 0.0) || ((
                          ((tmpvar_194.x < (tmpvar_186.x + (tmpvar_187.x * 0.5))) && (tmpvar_194.x > (tmpvar_186.x - (tmpvar_187.x * 0.5))))
                         && 
                          (tmpvar_194.z < (tmpvar_186.z + (tmpvar_187.y * 0.5)))
                        ) && (tmpvar_194.z > 
                          (tmpvar_186.z - (tmpvar_187.y * 0.5))
                        )))) {
                          t_hit_189 = tmpvar_193;
                          tmpvar_191 = bool(1);
                          tmpvar_190 = bool(0);
                        };
                      };
                      if (tmpvar_190) {
                        tmpvar_191 = bool(0);
                        tmpvar_190 = bool(0);
                      };
                      t_hit_155 = t_hit_189;
                      tmp_185 = tmpvar_191;
                    } else {
                      lowp float t_hit_196;
                      t_hit_196 = t_hit_155;
                      bool tmpvar_197;
                      lowp vec3 tmpvar_198;
                      tmpvar_198 = (tmpvar_186 - point_134);
                      lowp float tmpvar_199;
                      tmpvar_199 = dot (tmpvar_152, tmpvar_152);
                      lowp float tmpvar_200;
                      tmpvar_200 = (-2.0 * dot (tmpvar_152, tmpvar_198));
                      lowp float tmpvar_201;
                      tmpvar_201 = ((tmpvar_200 * tmpvar_200) - ((4.0 * tmpvar_199) * (
                        dot (tmpvar_198, tmpvar_198)
                       - 0.01)));
                      if ((tmpvar_201 < 0.0)) {
                        tmpvar_197 = bool(0);
                      } else {
                        lowp float tmpvar_202;
                        tmpvar_202 = sqrt(tmpvar_201);
                        lowp float tmpvar_203;
                        tmpvar_203 = ((-(tmpvar_200) - tmpvar_202) / (2.0 * tmpvar_199));
                        lowp float tmpvar_204;
                        tmpvar_204 = ((-(tmpvar_200) + tmpvar_202) / (2.0 * tmpvar_199));
                        lowp float tmpvar_205;
                        if ((tmpvar_203 < 0.01)) {
                          tmpvar_205 = tmpvar_204;
                        } else {
                          tmpvar_205 = tmpvar_203;
                        };
                        if (((tmpvar_205 < t_hit_155) && (tmpvar_205 > 0.01))) {
                          t_hit_196 = tmpvar_205;
                          tmpvar_197 = bool(1);
                        } else {
                          tmpvar_197 = bool(0);
                        };
                      };
                      t_hit_155 = t_hit_196;
                      tmp_185 = tmpvar_197;
                    };
                    if (tmp_185) {
                      idx_165 = i_162;
                      intersected_166 = 3;
                    };
                    i_162 = 1;
                    bool tmp_206;
                    if ((1 < numLights)) {
                      vec3 tmpvar_207;
                      tmpvar_207 = lightPos[1];
                      vec2 tmpvar_208;
                      tmpvar_208 = lightSize[1];
                      tmp_206 = bool(0);
                      float tmpvar_209;
                      tmpvar_209 = sqrt(dot (tmpvar_208, tmpvar_208));
                      if ((tmpvar_209 > 0.0)) {
                        lowp float t_hit_210;
                        t_hit_210 = t_hit_155;
                        bool tmpvar_211;
                        tmpvar_211 = bool(1);
                        bool tmpvar_212;
                        vec3 tmpvar_213;
                        tmpvar_213 = (vec3(0.0, 1.0, 0.0) * tmpvar_207.y);
                        lowp float tmpvar_214;
                        tmpvar_214 = (((
                          (tmpvar_213.x + tmpvar_213.y)
                         + tmpvar_213.z) - point_134.y) / tmpvar_152.y);
                        if (((tmpvar_214 < t_hit_155) && (tmpvar_214 > 0.01))) {
                          lowp vec3 tmpvar_215;
                          tmpvar_215 = (point_134 + (tmpvar_152 * tmpvar_214));
                          float tmpvar_216;
                          tmpvar_216 = sqrt(dot (tmpvar_208, tmpvar_208));
                          if (((tmpvar_216 == 0.0) || ((
                            ((tmpvar_215.x < (tmpvar_207.x + (tmpvar_208.x * 0.5))) && (tmpvar_215.x > (tmpvar_207.x - (tmpvar_208.x * 0.5))))
                           && 
                            (tmpvar_215.z < (tmpvar_207.z + (tmpvar_208.y * 0.5)))
                          ) && (tmpvar_215.z > 
                            (tmpvar_207.z - (tmpvar_208.y * 0.5))
                          )))) {
                            t_hit_210 = tmpvar_214;
                            tmpvar_212 = bool(1);
                            tmpvar_211 = bool(0);
                          };
                        };
                        if (tmpvar_211) {
                          tmpvar_212 = bool(0);
                          tmpvar_211 = bool(0);
                        };
                        t_hit_155 = t_hit_210;
                        tmp_206 = tmpvar_212;
                      } else {
                        lowp float t_hit_217;
                        t_hit_217 = t_hit_155;
                        bool tmpvar_218;
                        lowp vec3 tmpvar_219;
                        tmpvar_219 = (tmpvar_207 - point_134);
                        lowp float tmpvar_220;
                        tmpvar_220 = dot (tmpvar_152, tmpvar_152);
                        lowp float tmpvar_221;
                        tmpvar_221 = (-2.0 * dot (tmpvar_152, tmpvar_219));
                        lowp float tmpvar_222;
                        tmpvar_222 = ((tmpvar_221 * tmpvar_221) - ((4.0 * tmpvar_220) * (
                          dot (tmpvar_219, tmpvar_219)
                         - 0.01)));
                        if ((tmpvar_222 < 0.0)) {
                          tmpvar_218 = bool(0);
                        } else {
                          lowp float tmpvar_223;
                          tmpvar_223 = sqrt(tmpvar_222);
                          lowp float tmpvar_224;
                          tmpvar_224 = ((-(tmpvar_221) - tmpvar_223) / (2.0 * tmpvar_220));
                          lowp float tmpvar_225;
                          tmpvar_225 = ((-(tmpvar_221) + tmpvar_223) / (2.0 * tmpvar_220));
                          lowp float tmpvar_226;
                          if ((tmpvar_224 < 0.01)) {
                            tmpvar_226 = tmpvar_225;
                          } else {
                            tmpvar_226 = tmpvar_224;
                          };
                          if (((tmpvar_226 < t_hit_155) && (tmpvar_226 > 0.01))) {
                            t_hit_217 = tmpvar_226;
                            tmpvar_218 = bool(1);
                          } else {
                            tmpvar_218 = bool(0);
                          };
                        };
                        t_hit_155 = t_hit_217;
                        tmp_206 = tmpvar_218;
                      };
                      if (tmp_206) {
                        idx_165 = i_162;
                        intersected_166 = 3;
                      };
                      i_162 = 2;
                    };
                  };
                  position_156 = (point_134 + (tmpvar_152 * t_hit_155));
                  if ((intersected_166 == 1)) {
                    diffuseColor_158 = sphereColors[idx_165];
                    specularColor_159 = vec3(1.0, 1.0, 1.0);
                    reflectiveColor_160 = reflectiveColors[idx_165];
                    lowp vec3 tmpvar_227;
                    tmpvar_227 = normalize((position_156 - sphereCenters[idx_165]));
                    normal_157 = tmpvar_227;
                    lowp float tmpvar_228;
                    tmpvar_228 = dot (tmpvar_227, -(tmpvar_152));
                    if ((tmpvar_228 < 0.0)) {
                      normal_157 = -(tmpvar_227);
                    };
                  } else {
                    if ((intersected_166 == 2)) {
                      if (enablePlaneMirrors) {
                        diffuseColor_158 = vec3(0.1, 0.1, 0.1);
                        specularColor_159 = vec3(0.0, 0.0, 0.0);
                        reflectiveColor_160 = vec3(1.0, 1.0, 1.0);
                      } else {
                        diffuseColor_158 = planeColors[idx_165];
                        specularColor_159 = vec3(0.5, 0.5, 0.5);
                        reflectiveColor_160 = vec3(0.0, 0.0, 0.0);
                      };
                      lowp float tmpvar_229;
                      tmpvar_229 = dot (normal_157, -(tmpvar_152));
                      if ((tmpvar_229 < 0.0)) {
                        normal_157 = -(normal_157);
                      };
                    } else {
                      if ((intersected_166 == 3)) {
                        diffuseColor_158 = lightIntensity[idx_165];
                        isLight_161 = bool(1);
                      };
                    };
                  };
                  indirectDiffuseColor_147 = diffuseColor_158;
                  indirectSpecularColor_146 = specularColor_159;
                  indirectReflectiveColor_145 = reflectiveColor_160;
                  lowp vec3 tmpvar_230;
                  if (isLight_161) {
                    tmpvar_230 = vec3(0.0, 0.0, 0.0);
                  } else {
                    lowp vec3 point_231;
                    point_231 = position_156;
                    lowp vec3 ray_dir_232;
                    ray_dir_232 = tmpvar_152;
                    lowp vec3 normal_233;
                    normal_233 = normal_157;
                    vec3 diffuseColor_234;
                    diffuseColor_234 = diffuseColor_158;
                    vec3 specularColor_235;
                    specularColor_235 = specularColor_159;
                    highp int i_236;
                    lowp vec3 illuminationColor_237;
                    i_236 = 0;
                    while (true) {
                      highp int k_238;
                      lowp vec3 light_sum_239;
                      vec2 lightSize_240;
                      vec3 lightIntensity_241;
                      vec3 lightPos_242;
                      highp int areaShadowSamples_243;
                      if ((i_236 >= 2)) {
                        break;
                      };
                      if ((i_236 >= numLights)) {
                        break;
                      };
                      float tmpvar_244;
                      vec2 x_245;
                      x_245 = lightSize[i_236];
                      tmpvar_244 = sqrt(dot (x_245, x_245));
                      highp int tmpvar_246;
                      if ((tmpvar_244 > 0.0)) {
                        tmpvar_246 = shadowSamples;
                      } else {
                        tmpvar_246 = 1;
                      };
                      areaShadowSamples_243 = tmpvar_246;
                      lightPos_242 = lightPos[i_236];
                      lightIntensity_241 = lightIntensity[i_236];
                      lightSize_240 = lightSize[i_236];
                      k_238 = 0;
                      while (true) {
                        lowp vec3 incident_intensity_247;
                        if ((k_238 >= 49)) {
                          break;
                        };
                        if ((k_238 >= areaShadowSamples_243)) {
                          break;
                        };
                        float sample_i_248;
                        sample_i_248 = float(k_238);
                        lowp vec3 vec_to_light_249;
                        float tmpvar_250;
                        tmpvar_250 = sqrt(dot (lightSize_240, lightSize_240));
                        if ((tmpvar_250 > 0.0)) {
                          float tmpvar_251;
                          tmpvar_251 = (1.0/(shadowDim));
                          randomSeed += 0.02;
                          lowp float tmpvar_252;
                          tmpvar_252 = ((lightSize_240.x * tmpvar_251) * ((float(mod (sample_i_248, shadowDim))) + fract(
                            (cos(dot ((point_231.xy + randomSeed), vec2(23.14069, 2.665144))) * 12345.68)
                          )));
                          randomSeed += 0.02;
                          lowp vec3 tmpvar_253;
                          tmpvar_253.x = ((lightPos_242.x - (lightSize_240.x * 0.5)) + tmpvar_252);
                          tmpvar_253.y = lightPos_242.y;
                          tmpvar_253.z = ((lightPos_242.z - (lightSize_240.y * 0.5)) + ((lightSize_240.y * tmpvar_251) * (
                            floor((sample_i_248 * tmpvar_251))
                           + 
                            fract((cos(dot (
                              (point_231.yx + randomSeed)
                            , vec2(23.14069, 2.665144))) * 12345.68))
                          )));
                          vec_to_light_249 = (tmpvar_253 - point_231);
                        } else {
                          vec_to_light_249 = (lightPos_242 - point_231);
                        };
                        lowp float tmpvar_254;
                        tmpvar_254 = sqrt(dot (vec_to_light_249, vec_to_light_249));
                        lowp vec3 tmpvar_255;
                        tmpvar_255 = normalize(vec_to_light_249);
                        vec_to_light_249 = tmpvar_255;
                        incident_intensity_247 = (lightIntensity_241 * (1.0/((
                          (0.1 * (tmpvar_254 * tmpvar_254))
                         + 
                          (0.4 * tmpvar_254)
                        ))));
                        lowp vec3 ray_origin_256;
                        ray_origin_256 = point_231;
                        lowp vec3 ray_direction_257;
                        ray_direction_257 = tmpvar_255;
                        lowp float t_hit_258;
                        t_hit_258 = tmpvar_254;
                        bool tmpvar_259;
                        tmpvar_259 = bool(0);
                        highp int i_260;
                        highp int i_261;
                        i_261 = 0;
                        while (true) {
                          if ((i_261 >= 5)) {
                            break;
                          };
                          if ((i_261 >= numSpheres)) {
                            break;
                          };
                          lowp float t_hit_262;
                          t_hit_262 = t_hit_258;
                          bool tmpvar_263;
                          lowp vec3 tmpvar_264;
                          tmpvar_264 = (sphereCenters[i_261] - ray_origin_256);
                          lowp float tmpvar_265;
                          tmpvar_265 = dot (ray_direction_257, ray_direction_257);
                          lowp float tmpvar_266;
                          tmpvar_266 = (-2.0 * dot (ray_direction_257, tmpvar_264));
                          lowp float tmpvar_267;
                          tmpvar_267 = ((tmpvar_266 * tmpvar_266) - ((4.0 * tmpvar_265) * (
                            dot (tmpvar_264, tmpvar_264)
                           - 0.64)));
                          if ((tmpvar_267 < 0.0)) {
                            tmpvar_263 = bool(0);
                          } else {
                            lowp float tmpvar_268;
                            tmpvar_268 = sqrt(tmpvar_267);
                            lowp float tmpvar_269;
                            tmpvar_269 = ((-(tmpvar_266) - tmpvar_268) / (2.0 * tmpvar_265));
                            lowp float tmpvar_270;
                            tmpvar_270 = ((-(tmpvar_266) + tmpvar_268) / (2.0 * tmpvar_265));
                            lowp float tmpvar_271;
                            if ((tmpvar_269 < 0.01)) {
                              tmpvar_271 = tmpvar_270;
                            } else {
                              tmpvar_271 = tmpvar_269;
                            };
                            if (((tmpvar_271 < t_hit_258) && (tmpvar_271 > 0.01))) {
                              t_hit_262 = tmpvar_271;
                              tmpvar_263 = bool(1);
                            } else {
                              tmpvar_263 = bool(0);
                            };
                          };
                          t_hit_258 = t_hit_262;
                          if (tmpvar_263) {
                            tmpvar_259 = bool(1);
                            break;
                          };
                          i_261++;
                        };
                        if (!(tmpvar_259)) {
                          i_260 = 0;
                          while (true) {
                            if ((i_260 >= 6)) {
                              break;
                            };
                            if ((i_260 >= numPlanes)) {
                              break;
                            };
                            vec3 normal_272;
                            normal_272 = planeNormals[i_260];
                            lowp float t_hit_273;
                            t_hit_273 = t_hit_258;
                            bool tmpvar_274;
                            tmpvar_274 = bool(1);
                            bool tmpvar_275;
                            vec3 tmpvar_276;
                            tmpvar_276 = (normal_272 * planeOffsets[i_260]);
                            lowp float tmpvar_277;
                            tmpvar_277 = (((
                              (tmpvar_276.x + tmpvar_276.y)
                             + tmpvar_276.z) - dot (normal_272, ray_origin_256)) / dot (normal_272, ray_direction_257));
                            if (((tmpvar_277 < t_hit_258) && (tmpvar_277 > 0.01))) {
                              t_hit_273 = tmpvar_277;
                              tmpvar_275 = bool(1);
                              tmpvar_274 = bool(0);
                            };
                            if (tmpvar_274) {
                              tmpvar_275 = bool(0);
                              tmpvar_274 = bool(0);
                            };
                            t_hit_258 = t_hit_273;
                            if (tmpvar_275) {
                              tmpvar_259 = bool(1);
                              break;
                            };
                            i_260++;
                          };
                          if (!(tmpvar_259)) {
                            tmpvar_259 = bool(1);
                          };
                        };
                        lowp float tmpvar_278;
                        tmpvar_278 = abs((t_hit_258 - tmpvar_254));
                        if ((tmpvar_278 < 0.001)) {
                          lowp vec3 tmpvar_279;
                          lowp float tmpvar_280;
                          tmpvar_280 = dot (normal_233, tmpvar_255);
                          if ((tmpvar_280 > 0.0)) {
                            tmpvar_279 = ((incident_intensity_247 * max (0.0, 
                              dot (normal_233, tmpvar_255)
                            )) * (diffuseColor_234 + (specularColor_235 * 
                              pow (max (0.0, dot ((
                                -(tmpvar_255)
                               - 
                                ((2.0 * dot (-(tmpvar_255), normal_233)) * normal_233)
                              ), -(ray_dir_232))), 32.0)
                            )));
                          } else {
                            tmpvar_279 = vec3(0.0, 0.0, 0.0);
                          };
                          light_sum_239 = (light_sum_239 + tmpvar_279);
                        };
                        k_238++;
                      };
                      illuminationColor_237 = (illuminationColor_237 + (light_sum_239 / float(tmpvar_246)));
                      i_236++;
                    };
                    tmpvar_230 = (tmpvar_148 * illuminationColor_237);
                  };
                  indirect_sampling_sum_137 = (indirect_sampling_sum_137 + tmpvar_230);
                  k_136++;
                };
                tmpvar_135 = (((2.0 * indirect_sampling_sum_137) / float(indirectSamples)) * diffuseColor_11);
              };
              pixelColor_4 = (pixelColor_4 + tmpvar_135);
            };
            bool tmpvar_281;
            if ((rayBounces > 0)) {
              tmpvar_281 = (sqrt(dot (reflectiveColor_13, reflectiveColor_13)) > 0.0);
            } else {
              tmpvar_281 = bool(0);
            };
            if (tmpvar_281) {
              lowp vec3 origin_282;
              origin_282 = position_9;
              lowp vec3 rayDir_283;
              rayDir_283 = tmpvar_5;
              lowp vec3 normal_284;
              normal_284 = normal_10;
              vec3 reflectiveColor_285;
              reflectiveColor_285 = reflectiveColor_13;
              lowp vec3 reflectionSum_287;
              for (highp int i_286 = 0; i_286 < 5; i_286++) {
                lowp vec3 mirror_sample_color_288;
                vec3 bounceReflectiveColor_289;
                vec3 bounceSpecularColor_290;
                vec3 bounceDiffuseColor_291;
                bool tmpvar_292;
                if ((i_286 >= rayBounces)) {
                  tmpvar_292 = bool(1);
                } else {
                  tmpvar_292 = (sqrt(dot (reflectiveColor_285, reflectiveColor_285)) == 0.0);
                };
                if (tmpvar_292) {
                  break;
                };
                lowp vec3 tmpvar_293;
                tmpvar_293 = (rayDir_283 - ((2.0 * 
                  dot (rayDir_283, normal_284)
                ) * normal_284));
                lowp vec3 ray_origin_294;
                ray_origin_294 = origin_282;
                lowp vec3 ray_direction_295;
                ray_direction_295 = tmpvar_293;
                lowp float t_hit_296;
                t_hit_296 = 50.0;
                lowp vec3 position_297;
                lowp vec3 normal_298;
                vec3 diffuseColor_299;
                diffuseColor_299 = bounceDiffuseColor_291;
                vec3 specularColor_300;
                specularColor_300 = bounceSpecularColor_290;
                vec3 reflectiveColor_301;
                reflectiveColor_301 = bounceReflectiveColor_289;
                bool isLight_302;
                isLight_302 = bool(0);
                highp int i_303;
                highp int i_304;
                highp int i_305;
                highp int idx_306;
                highp int intersected_307;
                intersected_307 = 0;
                idx_306 = 0;
                i_305 = 0;
                while (true) {
                  if ((i_305 >= 5)) {
                    break;
                  };
                  if ((i_305 >= numSpheres)) {
                    break;
                  };
                  lowp float t_hit_308;
                  t_hit_308 = t_hit_296;
                  bool tmpvar_309;
                  lowp vec3 tmpvar_310;
                  tmpvar_310 = (sphereCenters[i_305] - ray_origin_294);
                  lowp float tmpvar_311;
                  tmpvar_311 = dot (ray_direction_295, ray_direction_295);
                  lowp float tmpvar_312;
                  tmpvar_312 = (-2.0 * dot (ray_direction_295, tmpvar_310));
                  lowp float tmpvar_313;
                  tmpvar_313 = ((tmpvar_312 * tmpvar_312) - ((4.0 * tmpvar_311) * (
                    dot (tmpvar_310, tmpvar_310)
                   - 0.64)));
                  if ((tmpvar_313 < 0.0)) {
                    tmpvar_309 = bool(0);
                  } else {
                    lowp float tmpvar_314;
                    tmpvar_314 = sqrt(tmpvar_313);
                    lowp float tmpvar_315;
                    tmpvar_315 = ((-(tmpvar_312) - tmpvar_314) / (2.0 * tmpvar_311));
                    lowp float tmpvar_316;
                    tmpvar_316 = ((-(tmpvar_312) + tmpvar_314) / (2.0 * tmpvar_311));
                    lowp float tmpvar_317;
                    if ((tmpvar_315 < 0.01)) {
                      tmpvar_317 = tmpvar_316;
                    } else {
                      tmpvar_317 = tmpvar_315;
                    };
                    if (((tmpvar_317 < t_hit_296) && (tmpvar_317 > 0.01))) {
                      t_hit_308 = tmpvar_317;
                      tmpvar_309 = bool(1);
                    } else {
                      tmpvar_309 = bool(0);
                    };
                  };
                  t_hit_296 = t_hit_308;
                  if (tmpvar_309) {
                    idx_306 = i_305;
                    intersected_307 = 1;
                  };
                  i_305++;
                };
                i_304 = 0;
                while (true) {
                  bool tmp_318;
                  if ((i_304 >= 6)) {
                    break;
                  };
                  if ((i_304 >= numPlanes)) {
                    break;
                  };
                  lowp vec3 tmpvar_319;
                  tmpvar_319 = planeNormals[i_304];
                  tmp_318 = bool(0);
                  bool tmpvar_320;
                  if (enablePlaneBacksides) {
                    tmpvar_320 = bool(1);
                  } else {
                    tmpvar_320 = (dot (ray_direction_295, tmpvar_319) < 0.0);
                  };
                  if (tmpvar_320) {
                    lowp float t_hit_321;
                    t_hit_321 = t_hit_296;
                    bool tmpvar_322;
                    tmpvar_322 = bool(1);
                    bool tmpvar_323;
                    lowp vec3 tmpvar_324;
                    tmpvar_324 = (tmpvar_319 * planeOffsets[i_304]);
                    lowp float tmpvar_325;
                    tmpvar_325 = (((
                      (tmpvar_324.x + tmpvar_324.y)
                     + tmpvar_324.z) - dot (tmpvar_319, ray_origin_294)) / dot (tmpvar_319, ray_direction_295));
                    if (((tmpvar_325 < t_hit_296) && (tmpvar_325 > 0.01))) {
                      t_hit_321 = tmpvar_325;
                      tmpvar_323 = bool(1);
                      tmpvar_322 = bool(0);
                    };
                    if (tmpvar_322) {
                      tmpvar_323 = bool(0);
                      tmpvar_322 = bool(0);
                    };
                    t_hit_296 = t_hit_321;
                    tmp_318 = tmpvar_323;
                  };
                  if (tmp_318) {
                    normal_298 = tmpvar_319;
                    idx_306 = i_304;
                    intersected_307 = 2;
                  };
                  i_304++;
                };
                i_303 = 0;
                bool tmp_326;
                if ((0 < numLights)) {
                  vec3 tmpvar_327;
                  tmpvar_327 = lightPos[0];
                  vec2 tmpvar_328;
                  tmpvar_328 = lightSize[0];
                  tmp_326 = bool(0);
                  float tmpvar_329;
                  tmpvar_329 = sqrt(dot (tmpvar_328, tmpvar_328));
                  if ((tmpvar_329 > 0.0)) {
                    lowp float t_hit_330;
                    t_hit_330 = t_hit_296;
                    bool tmpvar_331;
                    tmpvar_331 = bool(1);
                    bool tmpvar_332;
                    vec3 tmpvar_333;
                    tmpvar_333 = (vec3(0.0, 1.0, 0.0) * tmpvar_327.y);
                    lowp float tmpvar_334;
                    tmpvar_334 = (((
                      (tmpvar_333.x + tmpvar_333.y)
                     + tmpvar_333.z) - origin_282.y) / tmpvar_293.y);
                    if (((tmpvar_334 < t_hit_296) && (tmpvar_334 > 0.01))) {
                      lowp vec3 tmpvar_335;
                      tmpvar_335 = (origin_282 + (tmpvar_293 * tmpvar_334));
                      float tmpvar_336;
                      tmpvar_336 = sqrt(dot (tmpvar_328, tmpvar_328));
                      if (((tmpvar_336 == 0.0) || ((
                        ((tmpvar_335.x < (tmpvar_327.x + (tmpvar_328.x * 0.5))) && (tmpvar_335.x > (tmpvar_327.x - (tmpvar_328.x * 0.5))))
                       && 
                        (tmpvar_335.z < (tmpvar_327.z + (tmpvar_328.y * 0.5)))
                      ) && (tmpvar_335.z > 
                        (tmpvar_327.z - (tmpvar_328.y * 0.5))
                      )))) {
                        t_hit_330 = tmpvar_334;
                        tmpvar_332 = bool(1);
                        tmpvar_331 = bool(0);
                      };
                    };
                    if (tmpvar_331) {
                      tmpvar_332 = bool(0);
                      tmpvar_331 = bool(0);
                    };
                    t_hit_296 = t_hit_330;
                    tmp_326 = tmpvar_332;
                  } else {
                    lowp float t_hit_337;
                    t_hit_337 = t_hit_296;
                    bool tmpvar_338;
                    lowp vec3 tmpvar_339;
                    tmpvar_339 = (tmpvar_327 - origin_282);
                    lowp float tmpvar_340;
                    tmpvar_340 = dot (tmpvar_293, tmpvar_293);
                    lowp float tmpvar_341;
                    tmpvar_341 = (-2.0 * dot (tmpvar_293, tmpvar_339));
                    lowp float tmpvar_342;
                    tmpvar_342 = ((tmpvar_341 * tmpvar_341) - ((4.0 * tmpvar_340) * (
                      dot (tmpvar_339, tmpvar_339)
                     - 0.01)));
                    if ((tmpvar_342 < 0.0)) {
                      tmpvar_338 = bool(0);
                    } else {
                      lowp float tmpvar_343;
                      tmpvar_343 = sqrt(tmpvar_342);
                      lowp float tmpvar_344;
                      tmpvar_344 = ((-(tmpvar_341) - tmpvar_343) / (2.0 * tmpvar_340));
                      lowp float tmpvar_345;
                      tmpvar_345 = ((-(tmpvar_341) + tmpvar_343) / (2.0 * tmpvar_340));
                      lowp float tmpvar_346;
                      if ((tmpvar_344 < 0.01)) {
                        tmpvar_346 = tmpvar_345;
                      } else {
                        tmpvar_346 = tmpvar_344;
                      };
                      if (((tmpvar_346 < t_hit_296) && (tmpvar_346 > 0.01))) {
                        t_hit_337 = tmpvar_346;
                        tmpvar_338 = bool(1);
                      } else {
                        tmpvar_338 = bool(0);
                      };
                    };
                    t_hit_296 = t_hit_337;
                    tmp_326 = tmpvar_338;
                  };
                  if (tmp_326) {
                    idx_306 = i_303;
                    intersected_307 = 3;
                  };
                  i_303 = 1;
                  bool tmp_347;
                  if ((1 < numLights)) {
                    vec3 tmpvar_348;
                    tmpvar_348 = lightPos[1];
                    vec2 tmpvar_349;
                    tmpvar_349 = lightSize[1];
                    tmp_347 = bool(0);
                    float tmpvar_350;
                    tmpvar_350 = sqrt(dot (tmpvar_349, tmpvar_349));
                    if ((tmpvar_350 > 0.0)) {
                      lowp float t_hit_351;
                      t_hit_351 = t_hit_296;
                      bool tmpvar_352;
                      tmpvar_352 = bool(1);
                      bool tmpvar_353;
                      vec3 tmpvar_354;
                      tmpvar_354 = (vec3(0.0, 1.0, 0.0) * tmpvar_348.y);
                      lowp float tmpvar_355;
                      tmpvar_355 = (((
                        (tmpvar_354.x + tmpvar_354.y)
                       + tmpvar_354.z) - origin_282.y) / tmpvar_293.y);
                      if (((tmpvar_355 < t_hit_296) && (tmpvar_355 > 0.01))) {
                        lowp vec3 tmpvar_356;
                        tmpvar_356 = (origin_282 + (tmpvar_293 * tmpvar_355));
                        float tmpvar_357;
                        tmpvar_357 = sqrt(dot (tmpvar_349, tmpvar_349));
                        if (((tmpvar_357 == 0.0) || ((
                          ((tmpvar_356.x < (tmpvar_348.x + (tmpvar_349.x * 0.5))) && (tmpvar_356.x > (tmpvar_348.x - (tmpvar_349.x * 0.5))))
                         && 
                          (tmpvar_356.z < (tmpvar_348.z + (tmpvar_349.y * 0.5)))
                        ) && (tmpvar_356.z > 
                          (tmpvar_348.z - (tmpvar_349.y * 0.5))
                        )))) {
                          t_hit_351 = tmpvar_355;
                          tmpvar_353 = bool(1);
                          tmpvar_352 = bool(0);
                        };
                      };
                      if (tmpvar_352) {
                        tmpvar_353 = bool(0);
                        tmpvar_352 = bool(0);
                      };
                      t_hit_296 = t_hit_351;
                      tmp_347 = tmpvar_353;
                    } else {
                      lowp float t_hit_358;
                      t_hit_358 = t_hit_296;
                      bool tmpvar_359;
                      lowp vec3 tmpvar_360;
                      tmpvar_360 = (tmpvar_348 - origin_282);
                      lowp float tmpvar_361;
                      tmpvar_361 = dot (tmpvar_293, tmpvar_293);
                      lowp float tmpvar_362;
                      tmpvar_362 = (-2.0 * dot (tmpvar_293, tmpvar_360));
                      lowp float tmpvar_363;
                      tmpvar_363 = ((tmpvar_362 * tmpvar_362) - ((4.0 * tmpvar_361) * (
                        dot (tmpvar_360, tmpvar_360)
                       - 0.01)));
                      if ((tmpvar_363 < 0.0)) {
                        tmpvar_359 = bool(0);
                      } else {
                        lowp float tmpvar_364;
                        tmpvar_364 = sqrt(tmpvar_363);
                        lowp float tmpvar_365;
                        tmpvar_365 = ((-(tmpvar_362) - tmpvar_364) / (2.0 * tmpvar_361));
                        lowp float tmpvar_366;
                        tmpvar_366 = ((-(tmpvar_362) + tmpvar_364) / (2.0 * tmpvar_361));
                        lowp float tmpvar_367;
                        if ((tmpvar_365 < 0.01)) {
                          tmpvar_367 = tmpvar_366;
                        } else {
                          tmpvar_367 = tmpvar_365;
                        };
                        if (((tmpvar_367 < t_hit_296) && (tmpvar_367 > 0.01))) {
                          t_hit_358 = tmpvar_367;
                          tmpvar_359 = bool(1);
                        } else {
                          tmpvar_359 = bool(0);
                        };
                      };
                      t_hit_296 = t_hit_358;
                      tmp_347 = tmpvar_359;
                    };
                    if (tmp_347) {
                      idx_306 = i_303;
                      intersected_307 = 3;
                    };
                    i_303 = 2;
                  };
                };
                position_297 = (origin_282 + (tmpvar_293 * t_hit_296));
                if ((intersected_307 == 1)) {
                  diffuseColor_299 = sphereColors[idx_306];
                  specularColor_300 = vec3(1.0, 1.0, 1.0);
                  reflectiveColor_301 = reflectiveColors[idx_306];
                  lowp vec3 tmpvar_368;
                  tmpvar_368 = normalize((position_297 - sphereCenters[idx_306]));
                  normal_298 = tmpvar_368;
                  lowp float tmpvar_369;
                  tmpvar_369 = dot (tmpvar_368, -(tmpvar_293));
                  if ((tmpvar_369 < 0.0)) {
                    normal_298 = -(tmpvar_368);
                  };
                } else {
                  if ((intersected_307 == 2)) {
                    if (enablePlaneMirrors) {
                      diffuseColor_299 = vec3(0.1, 0.1, 0.1);
                      specularColor_300 = vec3(0.0, 0.0, 0.0);
                      reflectiveColor_301 = vec3(1.0, 1.0, 1.0);
                    } else {
                      diffuseColor_299 = planeColors[idx_306];
                      specularColor_300 = vec3(0.5, 0.5, 0.5);
                      reflectiveColor_301 = vec3(0.0, 0.0, 0.0);
                    };
                    lowp float tmpvar_370;
                    tmpvar_370 = dot (normal_298, -(tmpvar_293));
                    if ((tmpvar_370 < 0.0)) {
                      normal_298 = -(normal_298);
                    };
                  } else {
                    if ((intersected_307 == 3)) {
                      diffuseColor_299 = lightIntensity[idx_306];
                      isLight_302 = bool(1);
                    };
                  };
                };
                normal_284 = normal_298;
                bounceDiffuseColor_291 = diffuseColor_299;
                bounceSpecularColor_290 = specularColor_300;
                bounceReflectiveColor_289 = reflectiveColor_301;
                lowp vec3 tmpvar_371;
                if (isLight_302) {
                  tmpvar_371 = diffuseColor_299;
                } else {
                  lowp vec3 point_372;
                  point_372 = position_297;
                  lowp vec3 ray_dir_373;
                  ray_dir_373 = tmpvar_293;
                  lowp vec3 normal_374;
                  normal_374 = normal_298;
                  vec3 diffuseColor_375;
                  diffuseColor_375 = diffuseColor_299;
                  vec3 specularColor_376;
                  specularColor_376 = specularColor_300;
                  highp int i_377;
                  lowp vec3 illuminationColor_378;
                  i_377 = 0;
                  while (true) {
                    highp int k_379;
                    lowp vec3 light_sum_380;
                    vec2 lightSize_381;
                    vec3 lightIntensity_382;
                    vec3 lightPos_383;
                    highp int areaShadowSamples_384;
                    if ((i_377 >= 2)) {
                      break;
                    };
                    if ((i_377 >= numLights)) {
                      break;
                    };
                    float tmpvar_385;
                    vec2 x_386;
                    x_386 = lightSize[i_377];
                    tmpvar_385 = sqrt(dot (x_386, x_386));
                    highp int tmpvar_387;
                    if ((tmpvar_385 > 0.0)) {
                      tmpvar_387 = shadowSamples;
                    } else {
                      tmpvar_387 = 1;
                    };
                    areaShadowSamples_384 = tmpvar_387;
                    lightPos_383 = lightPos[i_377];
                    lightIntensity_382 = lightIntensity[i_377];
                    lightSize_381 = lightSize[i_377];
                    k_379 = 0;
                    while (true) {
                      lowp vec3 incident_intensity_388;
                      if ((k_379 >= 49)) {
                        break;
                      };
                      if ((k_379 >= areaShadowSamples_384)) {
                        break;
                      };
                      float sample_i_389;
                      sample_i_389 = float(k_379);
                      lowp vec3 vec_to_light_390;
                      float tmpvar_391;
                      tmpvar_391 = sqrt(dot (lightSize_381, lightSize_381));
                      if ((tmpvar_391 > 0.0)) {
                        float tmpvar_392;
                        tmpvar_392 = (1.0/(shadowDim));
                        randomSeed += 0.02;
                        lowp float tmpvar_393;
                        tmpvar_393 = ((lightSize_381.x * tmpvar_392) * ((float(mod (sample_i_389, shadowDim))) + fract(
                          (cos(dot ((point_372.xy + randomSeed), vec2(23.14069, 2.665144))) * 12345.68)
                        )));
                        randomSeed += 0.02;
                        lowp vec3 tmpvar_394;
                        tmpvar_394.x = ((lightPos_383.x - (lightSize_381.x * 0.5)) + tmpvar_393);
                        tmpvar_394.y = lightPos_383.y;
                        tmpvar_394.z = ((lightPos_383.z - (lightSize_381.y * 0.5)) + ((lightSize_381.y * tmpvar_392) * (
                          floor((sample_i_389 * tmpvar_392))
                         + 
                          fract((cos(dot (
                            (point_372.yx + randomSeed)
                          , vec2(23.14069, 2.665144))) * 12345.68))
                        )));
                        vec_to_light_390 = (tmpvar_394 - point_372);
                      } else {
                        vec_to_light_390 = (lightPos_383 - point_372);
                      };
                      lowp float tmpvar_395;
                      tmpvar_395 = sqrt(dot (vec_to_light_390, vec_to_light_390));
                      lowp vec3 tmpvar_396;
                      tmpvar_396 = normalize(vec_to_light_390);
                      vec_to_light_390 = tmpvar_396;
                      incident_intensity_388 = (lightIntensity_382 * (1.0/((
                        (0.1 * (tmpvar_395 * tmpvar_395))
                       + 
                        (0.4 * tmpvar_395)
                      ))));
                      lowp vec3 ray_origin_397;
                      ray_origin_397 = point_372;
                      lowp vec3 ray_direction_398;
                      ray_direction_398 = tmpvar_396;
                      lowp float t_hit_399;
                      t_hit_399 = tmpvar_395;
                      bool tmpvar_400;
                      tmpvar_400 = bool(0);
                      highp int i_401;
                      highp int i_402;
                      i_402 = 0;
                      while (true) {
                        if ((i_402 >= 5)) {
                          break;
                        };
                        if ((i_402 >= numSpheres)) {
                          break;
                        };
                        lowp float t_hit_403;
                        t_hit_403 = t_hit_399;
                        bool tmpvar_404;
                        lowp vec3 tmpvar_405;
                        tmpvar_405 = (sphereCenters[i_402] - ray_origin_397);
                        lowp float tmpvar_406;
                        tmpvar_406 = dot (ray_direction_398, ray_direction_398);
                        lowp float tmpvar_407;
                        tmpvar_407 = (-2.0 * dot (ray_direction_398, tmpvar_405));
                        lowp float tmpvar_408;
                        tmpvar_408 = ((tmpvar_407 * tmpvar_407) - ((4.0 * tmpvar_406) * (
                          dot (tmpvar_405, tmpvar_405)
                         - 0.64)));
                        if ((tmpvar_408 < 0.0)) {
                          tmpvar_404 = bool(0);
                        } else {
                          lowp float tmpvar_409;
                          tmpvar_409 = sqrt(tmpvar_408);
                          lowp float tmpvar_410;
                          tmpvar_410 = ((-(tmpvar_407) - tmpvar_409) / (2.0 * tmpvar_406));
                          lowp float tmpvar_411;
                          tmpvar_411 = ((-(tmpvar_407) + tmpvar_409) / (2.0 * tmpvar_406));
                          lowp float tmpvar_412;
                          if ((tmpvar_410 < 0.01)) {
                            tmpvar_412 = tmpvar_411;
                          } else {
                            tmpvar_412 = tmpvar_410;
                          };
                          if (((tmpvar_412 < t_hit_399) && (tmpvar_412 > 0.01))) {
                            t_hit_403 = tmpvar_412;
                            tmpvar_404 = bool(1);
                          } else {
                            tmpvar_404 = bool(0);
                          };
                        };
                        t_hit_399 = t_hit_403;
                        if (tmpvar_404) {
                          tmpvar_400 = bool(1);
                          break;
                        };
                        i_402++;
                      };
                      if (!(tmpvar_400)) {
                        i_401 = 0;
                        while (true) {
                          if ((i_401 >= 6)) {
                            break;
                          };
                          if ((i_401 >= numPlanes)) {
                            break;
                          };
                          vec3 normal_413;
                          normal_413 = planeNormals[i_401];
                          lowp float t_hit_414;
                          t_hit_414 = t_hit_399;
                          bool tmpvar_415;
                          tmpvar_415 = bool(1);
                          bool tmpvar_416;
                          vec3 tmpvar_417;
                          tmpvar_417 = (normal_413 * planeOffsets[i_401]);
                          lowp float tmpvar_418;
                          tmpvar_418 = (((
                            (tmpvar_417.x + tmpvar_417.y)
                           + tmpvar_417.z) - dot (normal_413, ray_origin_397)) / dot (normal_413, ray_direction_398));
                          if (((tmpvar_418 < t_hit_399) && (tmpvar_418 > 0.01))) {
                            t_hit_414 = tmpvar_418;
                            tmpvar_416 = bool(1);
                            tmpvar_415 = bool(0);
                          };
                          if (tmpvar_415) {
                            tmpvar_416 = bool(0);
                            tmpvar_415 = bool(0);
                          };
                          t_hit_399 = t_hit_414;
                          if (tmpvar_416) {
                            tmpvar_400 = bool(1);
                            break;
                          };
                          i_401++;
                        };
                        if (!(tmpvar_400)) {
                          tmpvar_400 = bool(1);
                        };
                      };
                      lowp float tmpvar_419;
                      tmpvar_419 = abs((t_hit_399 - tmpvar_395));
                      if ((tmpvar_419 < 0.001)) {
                        lowp vec3 tmpvar_420;
                        lowp float tmpvar_421;
                        tmpvar_421 = dot (normal_374, tmpvar_396);
                        if ((tmpvar_421 > 0.0)) {
                          tmpvar_420 = ((incident_intensity_388 * max (0.0, 
                            dot (normal_374, tmpvar_396)
                          )) * (diffuseColor_375 + (specularColor_376 * 
                            pow (max (0.0, dot ((
                              -(tmpvar_396)
                             - 
                              ((2.0 * dot (-(tmpvar_396), normal_374)) * normal_374)
                            ), -(ray_dir_373))), 32.0)
                          )));
                        } else {
                          tmpvar_420 = vec3(0.0, 0.0, 0.0);
                        };
                        light_sum_380 = (light_sum_380 + tmpvar_420);
                      };
                      k_379++;
                    };
                    illuminationColor_378 = (illuminationColor_378 + (light_sum_380 / float(tmpvar_387)));
                    i_377++;
                  };
                  tmpvar_371 = illuminationColor_378;
                };
                mirror_sample_color_288 = tmpvar_371;
                if (enableRefGI) {
                  lowp vec3 point_422;
                  point_422 = position_297;
                  lowp vec3 tmpvar_423;
                  highp int k_424;
                  lowp vec3 indirect_sampling_sum_425;
                  lowp mat3 transform_426;
                  float tmpvar_427;
                  tmpvar_427 = sqrt(dot (diffuseColor_299, diffuseColor_299));
                  if ((tmpvar_427 == 0.0)) {
                    tmpvar_423 = vec3(0.0, 0.0, 0.0);
                  } else {
                    lowp float tmpvar_428;
                    tmpvar_428 = abs(normal_298.x);
                    lowp float tmpvar_429;
                    tmpvar_429 = abs(normal_298.y);
                    if ((tmpvar_428 > tmpvar_429)) {
                      lowp vec3 tmpvar_430;
                      tmpvar_430.y = 0.0;
                      tmpvar_430.x = normal_298.z;
                      tmpvar_430.z = -(normal_298.x);
                      transform_426[2] = (tmpvar_430 / sqrt((
                        (normal_298.x * normal_298.x)
                       + 
                        (normal_298.z * normal_298.z)
                      )));
                    } else {
                      lowp vec3 tmpvar_431;
                      tmpvar_431.x = 0.0;
                      tmpvar_431.y = -(normal_298.z);
                      tmpvar_431.z = normal_298.y;
                      transform_426[2] = (tmpvar_431 / sqrt((
                        (normal_298.y * normal_298.y)
                       + 
                        (normal_298.z * normal_298.z)
                      )));
                    };
                    lowp vec3 b_432;
                    b_432 = transform_426[2];
                    transform_426[0] = ((normal_298.yzx * b_432.zxy) - (normal_298.zxy * b_432.yzx));
                    transform_426[1] = normal_298;
                    k_424 = 0;
                    while (true) {
                      vec3 indirectReflectiveColor_433;
                      vec3 indirectSpecularColor_434;
                      vec3 indirectDiffuseColor_435;
                      if ((k_424 >= 100)) {
                        break;
                      };
                      if ((k_424 >= indirectSamples)) {
                        break;
                      };
                      randomSeed += 0.02;
                      lowp float tmpvar_436;
                      tmpvar_436 = fract((cos(
                        dot ((point_422.xy + randomSeed), vec2(23.14069, 2.665144))
                      ) * 12345.68));
                      lowp float tmpvar_437;
                      tmpvar_437 = sqrt((1.0 - (tmpvar_436 * tmpvar_436)));
                      randomSeed += 0.02;
                      lowp float tmpvar_438;
                      tmpvar_438 = (6.283186 * fract((
                        cos(dot ((point_422.yx + randomSeed), vec2(23.14069, 2.665144)))
                       * 12345.68)));
                      lowp vec3 tmpvar_439;
                      tmpvar_439.x = (cos(tmpvar_438) * tmpvar_437);
                      tmpvar_439.y = tmpvar_436;
                      tmpvar_439.z = (sin(tmpvar_438) * tmpvar_437);
                      lowp vec3 tmpvar_440;
                      tmpvar_440 = (transform_426 * tmpvar_439);
                      lowp vec3 ray_origin_441;
                      ray_origin_441 = point_422;
                      lowp vec3 ray_direction_442;
                      ray_direction_442 = tmpvar_440;
                      lowp float t_hit_443;
                      t_hit_443 = 10.0;
                      lowp vec3 position_444;
                      lowp vec3 normal_445;
                      vec3 diffuseColor_446;
                      diffuseColor_446 = indirectDiffuseColor_435;
                      vec3 specularColor_447;
                      specularColor_447 = indirectSpecularColor_434;
                      vec3 reflectiveColor_448;
                      reflectiveColor_448 = indirectReflectiveColor_433;
                      bool isLight_449;
                      isLight_449 = bool(0);
                      highp int i_450;
                      highp int i_451;
                      highp int i_452;
                      highp int idx_453;
                      highp int intersected_454;
                      intersected_454 = 0;
                      idx_453 = 0;
                      i_452 = 0;
                      while (true) {
                        if ((i_452 >= 5)) {
                          break;
                        };
                        if ((i_452 >= numSpheres)) {
                          break;
                        };
                        lowp float t_hit_455;
                        t_hit_455 = t_hit_443;
                        bool tmpvar_456;
                        lowp vec3 tmpvar_457;
                        tmpvar_457 = (sphereCenters[i_452] - ray_origin_441);
                        lowp float tmpvar_458;
                        tmpvar_458 = dot (ray_direction_442, ray_direction_442);
                        lowp float tmpvar_459;
                        tmpvar_459 = (-2.0 * dot (ray_direction_442, tmpvar_457));
                        lowp float tmpvar_460;
                        tmpvar_460 = ((tmpvar_459 * tmpvar_459) - ((4.0 * tmpvar_458) * (
                          dot (tmpvar_457, tmpvar_457)
                         - 0.64)));
                        if ((tmpvar_460 < 0.0)) {
                          tmpvar_456 = bool(0);
                        } else {
                          lowp float tmpvar_461;
                          tmpvar_461 = sqrt(tmpvar_460);
                          lowp float tmpvar_462;
                          tmpvar_462 = ((-(tmpvar_459) - tmpvar_461) / (2.0 * tmpvar_458));
                          lowp float tmpvar_463;
                          tmpvar_463 = ((-(tmpvar_459) + tmpvar_461) / (2.0 * tmpvar_458));
                          lowp float tmpvar_464;
                          if ((tmpvar_462 < 0.01)) {
                            tmpvar_464 = tmpvar_463;
                          } else {
                            tmpvar_464 = tmpvar_462;
                          };
                          if (((tmpvar_464 < t_hit_443) && (tmpvar_464 > 0.01))) {
                            t_hit_455 = tmpvar_464;
                            tmpvar_456 = bool(1);
                          } else {
                            tmpvar_456 = bool(0);
                          };
                        };
                        t_hit_443 = t_hit_455;
                        if (tmpvar_456) {
                          idx_453 = i_452;
                          intersected_454 = 1;
                        };
                        i_452++;
                      };
                      i_451 = 0;
                      while (true) {
                        bool tmp_465;
                        if ((i_451 >= 6)) {
                          break;
                        };
                        if ((i_451 >= numPlanes)) {
                          break;
                        };
                        lowp vec3 tmpvar_466;
                        tmpvar_466 = planeNormals[i_451];
                        tmp_465 = bool(0);
                        bool tmpvar_467;
                        if (enablePlaneBacksides) {
                          tmpvar_467 = bool(1);
                        } else {
                          tmpvar_467 = (dot (ray_direction_442, tmpvar_466) < 0.0);
                        };
                        if (tmpvar_467) {
                          lowp float t_hit_468;
                          t_hit_468 = t_hit_443;
                          bool tmpvar_469;
                          tmpvar_469 = bool(1);
                          bool tmpvar_470;
                          lowp vec3 tmpvar_471;
                          tmpvar_471 = (tmpvar_466 * planeOffsets[i_451]);
                          lowp float tmpvar_472;
                          tmpvar_472 = (((
                            (tmpvar_471.x + tmpvar_471.y)
                           + tmpvar_471.z) - dot (tmpvar_466, ray_origin_441)) / dot (tmpvar_466, ray_direction_442));
                          if (((tmpvar_472 < t_hit_443) && (tmpvar_472 > 0.01))) {
                            t_hit_468 = tmpvar_472;
                            tmpvar_470 = bool(1);
                            tmpvar_469 = bool(0);
                          };
                          if (tmpvar_469) {
                            tmpvar_470 = bool(0);
                            tmpvar_469 = bool(0);
                          };
                          t_hit_443 = t_hit_468;
                          tmp_465 = tmpvar_470;
                        };
                        if (tmp_465) {
                          normal_445 = tmpvar_466;
                          idx_453 = i_451;
                          intersected_454 = 2;
                        };
                        i_451++;
                      };
                      i_450 = 0;
                      while (true) {
                        bool tmp_473;
                        if ((i_450 >= 2)) {
                          break;
                        };
                        if ((i_450 >= numLights)) {
                          break;
                        };
                        vec3 tmpvar_474;
                        tmpvar_474 = lightPos[i_450];
                        vec2 tmpvar_475;
                        tmpvar_475 = lightSize[i_450];
                        tmp_473 = bool(0);
                        float tmpvar_476;
                        tmpvar_476 = sqrt(dot (tmpvar_475, tmpvar_475));
                        if ((tmpvar_476 > 0.0)) {
                          lowp float t_hit_477;
                          t_hit_477 = t_hit_443;
                          bool tmpvar_478;
                          tmpvar_478 = bool(1);
                          bool tmpvar_479;
                          vec3 tmpvar_480;
                          tmpvar_480 = (vec3(0.0, 1.0, 0.0) * tmpvar_474.y);
                          lowp float tmpvar_481;
                          tmpvar_481 = (((
                            (tmpvar_480.x + tmpvar_480.y)
                           + tmpvar_480.z) - ray_origin_441.y) / ray_direction_442.y);
                          if (((tmpvar_481 < t_hit_443) && (tmpvar_481 > 0.01))) {
                            lowp vec3 tmpvar_482;
                            tmpvar_482 = (ray_origin_441 + (ray_direction_442 * tmpvar_481));
                            float tmpvar_483;
                            tmpvar_483 = sqrt(dot (tmpvar_475, tmpvar_475));
                            if (((tmpvar_483 == 0.0) || ((
                              ((tmpvar_482.x < (tmpvar_474.x + (tmpvar_475.x * 0.5))) && (tmpvar_482.x > (tmpvar_474.x - (tmpvar_475.x * 0.5))))
                             && 
                              (tmpvar_482.z < (tmpvar_474.z + (tmpvar_475.y * 0.5)))
                            ) && (tmpvar_482.z > 
                              (tmpvar_474.z - (tmpvar_475.y * 0.5))
                            )))) {
                              t_hit_477 = tmpvar_481;
                              tmpvar_479 = bool(1);
                              tmpvar_478 = bool(0);
                            };
                          };
                          if (tmpvar_478) {
                            tmpvar_479 = bool(0);
                            tmpvar_478 = bool(0);
                          };
                          t_hit_443 = t_hit_477;
                          tmp_473 = tmpvar_479;
                        } else {
                          lowp float t_hit_484;
                          t_hit_484 = t_hit_443;
                          bool tmpvar_485;
                          lowp vec3 tmpvar_486;
                          tmpvar_486 = (tmpvar_474 - ray_origin_441);
                          lowp float tmpvar_487;
                          tmpvar_487 = dot (ray_direction_442, ray_direction_442);
                          lowp float tmpvar_488;
                          tmpvar_488 = (-2.0 * dot (ray_direction_442, tmpvar_486));
                          lowp float tmpvar_489;
                          tmpvar_489 = ((tmpvar_488 * tmpvar_488) - ((4.0 * tmpvar_487) * (
                            dot (tmpvar_486, tmpvar_486)
                           - 0.01)));
                          if ((tmpvar_489 < 0.0)) {
                            tmpvar_485 = bool(0);
                          } else {
                            lowp float tmpvar_490;
                            tmpvar_490 = sqrt(tmpvar_489);
                            lowp float tmpvar_491;
                            tmpvar_491 = ((-(tmpvar_488) - tmpvar_490) / (2.0 * tmpvar_487));
                            lowp float tmpvar_492;
                            tmpvar_492 = ((-(tmpvar_488) + tmpvar_490) / (2.0 * tmpvar_487));
                            lowp float tmpvar_493;
                            if ((tmpvar_491 < 0.01)) {
                              tmpvar_493 = tmpvar_492;
                            } else {
                              tmpvar_493 = tmpvar_491;
                            };
                            if (((tmpvar_493 < t_hit_443) && (tmpvar_493 > 0.01))) {
                              t_hit_484 = tmpvar_493;
                              tmpvar_485 = bool(1);
                            } else {
                              tmpvar_485 = bool(0);
                            };
                          };
                          t_hit_443 = t_hit_484;
                          tmp_473 = tmpvar_485;
                        };
                        if (tmp_473) {
                          idx_453 = i_450;
                          intersected_454 = 3;
                        };
                        i_450++;
                      };
                      position_444 = (point_422 + (tmpvar_440 * t_hit_443));
                      if ((intersected_454 == 1)) {
                        diffuseColor_446 = sphereColors[idx_453];
                        specularColor_447 = vec3(1.0, 1.0, 1.0);
                        reflectiveColor_448 = reflectiveColors[idx_453];
                        lowp vec3 tmpvar_494;
                        tmpvar_494 = normalize((position_444 - sphereCenters[idx_453]));
                        normal_445 = tmpvar_494;
                        lowp float tmpvar_495;
                        tmpvar_495 = dot (tmpvar_494, -(tmpvar_440));
                        if ((tmpvar_495 < 0.0)) {
                          normal_445 = -(tmpvar_494);
                        };
                      } else {
                        if ((intersected_454 == 2)) {
                          if (enablePlaneMirrors) {
                            diffuseColor_446 = vec3(0.1, 0.1, 0.1);
                            specularColor_447 = vec3(0.0, 0.0, 0.0);
                            reflectiveColor_448 = vec3(1.0, 1.0, 1.0);
                          } else {
                            diffuseColor_446 = planeColors[idx_453];
                            specularColor_447 = vec3(0.5, 0.5, 0.5);
                            reflectiveColor_448 = vec3(0.0, 0.0, 0.0);
                          };
                          lowp float tmpvar_496;
                          tmpvar_496 = dot (normal_445, -(tmpvar_440));
                          if ((tmpvar_496 < 0.0)) {
                            normal_445 = -(normal_445);
                          };
                        } else {
                          if ((intersected_454 == 3)) {
                            diffuseColor_446 = lightIntensity[idx_453];
                            isLight_449 = bool(1);
                          };
                        };
                      };
                      indirectDiffuseColor_435 = diffuseColor_446;
                      indirectSpecularColor_434 = specularColor_447;
                      indirectReflectiveColor_433 = reflectiveColor_448;
                      lowp vec3 tmpvar_497;
                      if (isLight_449) {
                        tmpvar_497 = vec3(0.0, 0.0, 0.0);
                      } else {
                        lowp vec3 point_498;
                        point_498 = position_444;
                        lowp vec3 ray_dir_499;
                        ray_dir_499 = tmpvar_440;
                        lowp vec3 normal_500;
                        normal_500 = normal_445;
                        vec3 diffuseColor_501;
                        diffuseColor_501 = diffuseColor_446;
                        vec3 specularColor_502;
                        specularColor_502 = specularColor_447;
                        highp int i_503;
                        lowp vec3 illuminationColor_504;
                        i_503 = 0;
                        while (true) {
                          highp int k_505;
                          lowp vec3 light_sum_506;
                          vec2 lightSize_507;
                          vec3 lightIntensity_508;
                          vec3 lightPos_509;
                          highp int areaShadowSamples_510;
                          if ((i_503 >= 2)) {
                            break;
                          };
                          if ((i_503 >= numLights)) {
                            break;
                          };
                          float tmpvar_511;
                          vec2 x_512;
                          x_512 = lightSize[i_503];
                          tmpvar_511 = sqrt(dot (x_512, x_512));
                          highp int tmpvar_513;
                          if ((tmpvar_511 > 0.0)) {
                            tmpvar_513 = shadowSamples;
                          } else {
                            tmpvar_513 = 1;
                          };
                          areaShadowSamples_510 = tmpvar_513;
                          lightPos_509 = lightPos[i_503];
                          lightIntensity_508 = lightIntensity[i_503];
                          lightSize_507 = lightSize[i_503];
                          k_505 = 0;
                          while (true) {
                            lowp vec3 incident_intensity_514;
                            if ((k_505 >= 49)) {
                              break;
                            };
                            if ((k_505 >= areaShadowSamples_510)) {
                              break;
                            };
                            float sample_i_515;
                            sample_i_515 = float(k_505);
                            lowp vec3 vec_to_light_516;
                            float tmpvar_517;
                            tmpvar_517 = sqrt(dot (lightSize_507, lightSize_507));
                            if ((tmpvar_517 > 0.0)) {
                              float tmpvar_518;
                              tmpvar_518 = (1.0/(shadowDim));
                              randomSeed += 0.02;
                              lowp float tmpvar_519;
                              tmpvar_519 = ((lightSize_507.x * tmpvar_518) * ((float(mod (sample_i_515, shadowDim))) + fract(
                                (cos(dot ((point_498.xy + randomSeed), vec2(23.14069, 2.665144))) * 12345.68)
                              )));
                              randomSeed += 0.02;
                              lowp vec3 tmpvar_520;
                              tmpvar_520.x = ((lightPos_509.x - (lightSize_507.x * 0.5)) + tmpvar_519);
                              tmpvar_520.y = lightPos_509.y;
                              tmpvar_520.z = ((lightPos_509.z - (lightSize_507.y * 0.5)) + ((lightSize_507.y * tmpvar_518) * (
                                floor((sample_i_515 * tmpvar_518))
                               + 
                                fract((cos(dot (
                                  (point_498.yx + randomSeed)
                                , vec2(23.14069, 2.665144))) * 12345.68))
                              )));
                              vec_to_light_516 = (tmpvar_520 - point_498);
                            } else {
                              vec_to_light_516 = (lightPos_509 - point_498);
                            };
                            lowp float tmpvar_521;
                            tmpvar_521 = sqrt(dot (vec_to_light_516, vec_to_light_516));
                            lowp vec3 tmpvar_522;
                            tmpvar_522 = normalize(vec_to_light_516);
                            vec_to_light_516 = tmpvar_522;
                            incident_intensity_514 = (lightIntensity_508 * (1.0/((
                              (0.1 * (tmpvar_521 * tmpvar_521))
                             + 
                              (0.4 * tmpvar_521)
                            ))));
                            lowp vec3 ray_origin_523;
                            ray_origin_523 = point_498;
                            lowp vec3 ray_direction_524;
                            ray_direction_524 = tmpvar_522;
                            lowp float t_hit_525;
                            t_hit_525 = tmpvar_521;
                            bool tmpvar_526;
                            tmpvar_526 = bool(0);
                            highp int i_527;
                            highp int i_528;
                            i_528 = 0;
                            while (true) {
                              if ((i_528 >= 5)) {
                                break;
                              };
                              if ((i_528 >= numSpheres)) {
                                break;
                              };
                              lowp float t_hit_529;
                              t_hit_529 = t_hit_525;
                              bool tmpvar_530;
                              lowp vec3 tmpvar_531;
                              tmpvar_531 = (sphereCenters[i_528] - ray_origin_523);
                              lowp float tmpvar_532;
                              tmpvar_532 = dot (ray_direction_524, ray_direction_524);
                              lowp float tmpvar_533;
                              tmpvar_533 = (-2.0 * dot (ray_direction_524, tmpvar_531));
                              lowp float tmpvar_534;
                              tmpvar_534 = ((tmpvar_533 * tmpvar_533) - ((4.0 * tmpvar_532) * (
                                dot (tmpvar_531, tmpvar_531)
                               - 0.64)));
                              if ((tmpvar_534 < 0.0)) {
                                tmpvar_530 = bool(0);
                              } else {
                                lowp float tmpvar_535;
                                tmpvar_535 = sqrt(tmpvar_534);
                                lowp float tmpvar_536;
                                tmpvar_536 = ((-(tmpvar_533) - tmpvar_535) / (2.0 * tmpvar_532));
                                lowp float tmpvar_537;
                                tmpvar_537 = ((-(tmpvar_533) + tmpvar_535) / (2.0 * tmpvar_532));
                                lowp float tmpvar_538;
                                if ((tmpvar_536 < 0.01)) {
                                  tmpvar_538 = tmpvar_537;
                                } else {
                                  tmpvar_538 = tmpvar_536;
                                };
                                if (((tmpvar_538 < t_hit_525) && (tmpvar_538 > 0.01))) {
                                  t_hit_529 = tmpvar_538;
                                  tmpvar_530 = bool(1);
                                } else {
                                  tmpvar_530 = bool(0);
                                };
                              };
                              t_hit_525 = t_hit_529;
                              if (tmpvar_530) {
                                tmpvar_526 = bool(1);
                                break;
                              };
                              i_528++;
                            };
                            if (!(tmpvar_526)) {
                              i_527 = 0;
                              while (true) {
                                if ((i_527 >= 6)) {
                                  break;
                                };
                                if ((i_527 >= numPlanes)) {
                                  break;
                                };
                                vec3 normal_539;
                                normal_539 = planeNormals[i_527];
                                lowp float t_hit_540;
                                t_hit_540 = t_hit_525;
                                bool tmpvar_541;
                                tmpvar_541 = bool(1);
                                bool tmpvar_542;
                                vec3 tmpvar_543;
                                tmpvar_543 = (normal_539 * planeOffsets[i_527]);
                                lowp float tmpvar_544;
                                tmpvar_544 = (((
                                  (tmpvar_543.x + tmpvar_543.y)
                                 + tmpvar_543.z) - dot (normal_539, ray_origin_523)) / dot (normal_539, ray_direction_524));
                                if (((tmpvar_544 < t_hit_525) && (tmpvar_544 > 0.01))) {
                                  t_hit_540 = tmpvar_544;
                                  tmpvar_542 = bool(1);
                                  tmpvar_541 = bool(0);
                                };
                                if (tmpvar_541) {
                                  tmpvar_542 = bool(0);
                                  tmpvar_541 = bool(0);
                                };
                                t_hit_525 = t_hit_540;
                                if (tmpvar_542) {
                                  tmpvar_526 = bool(1);
                                  break;
                                };
                                i_527++;
                              };
                              if (!(tmpvar_526)) {
                                tmpvar_526 = bool(1);
                              };
                            };
                            lowp float tmpvar_545;
                            tmpvar_545 = abs((t_hit_525 - tmpvar_521));
                            if ((tmpvar_545 < 0.001)) {
                              lowp vec3 tmpvar_546;
                              lowp float tmpvar_547;
                              tmpvar_547 = dot (normal_500, tmpvar_522);
                              if ((tmpvar_547 > 0.0)) {
                                tmpvar_546 = ((incident_intensity_514 * max (0.0, 
                                  dot (normal_500, tmpvar_522)
                                )) * (diffuseColor_501 + (specularColor_502 * 
                                  pow (max (0.0, dot ((
                                    -(tmpvar_522)
                                   - 
                                    ((2.0 * dot (-(tmpvar_522), normal_500)) * normal_500)
                                  ), -(ray_dir_499))), 32.0)
                                )));
                              } else {
                                tmpvar_546 = vec3(0.0, 0.0, 0.0);
                              };
                              light_sum_506 = (light_sum_506 + tmpvar_546);
                            };
                            k_505++;
                          };
                          illuminationColor_504 = (illuminationColor_504 + (light_sum_506 / float(tmpvar_513)));
                          i_503++;
                        };
                        tmpvar_497 = (tmpvar_436 * illuminationColor_504);
                      };
                      indirect_sampling_sum_425 = (indirect_sampling_sum_425 + tmpvar_497);
                      k_424++;
                    };
                    tmpvar_423 = (((2.0 * indirect_sampling_sum_425) / float(indirectSamples)) * diffuseColor_299);
                  };
                  mirror_sample_color_288 = (tmpvar_371 + tmpvar_423);
                };
                reflectionSum_287 = (reflectionSum_287 + (mirror_sample_color_288 * reflectiveColor_285));
                origin_282 = position_297;
                rayDir_283 = tmpvar_293;
                reflectiveColor_285 = (reflectiveColor_301 * reflectiveColor_285);
              };
              pixelColor_4 = (pixelColor_4 + reflectionSum_287);
            };
            lowp vec4 tmpvar_548;
            tmpvar_548.w = 1.0;
            tmpvar_548.xyz = pixelColor_4;
            fragColor = tmpvar_548;
          }
          
          
        </script>
          
        <script src="webgl-utils.js"></script>
        <script src='gl-matrix-min.js'></script>
        <script src='world-state.js'></script>
        <script src='raytracer.js'></script>
    </body>
</html>